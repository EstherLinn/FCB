@using Foundation.Wealth.Helper
@using Feature.Wealth.Component.Models.HighRatedFund
@model HighRatedFundModel

@{
    var modelitem = Model.Item;
}

<div class="l-mainstage">
    <div class="l-mainstage__wrap">
        <div class="l-mainstage__title">
            <h1 class="t-title">@Html.Sitecore().Field(HighRatedFundModel.Template.HighRatedFund.Fields.MainTitle.ToString(), modelitem)</h1>
        </div>
        <div class="l-mainstage__content">
            <div class="l-flex u-flex-col u-flex-gap-sm">
                <div class="l-flex__item">
                    @Html.Sitecore().Field(HighRatedFundModel.Template.HighRatedFund.Fields.SubTitle.ToString(), modelitem)
                </div>
                <div class="l-flex__item">
                    <span class="t-note">@Html.Sitecore().Field(HighRatedFundModel.Template.HighRatedFund.Fields.Content.ToString(), modelitem)</span>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="l-wrap">
    <div class="l-stage">
        <div class="l-flex u-flex-col u-flex-gap-sm">
            <div class="l-flex__item u-right u-hidden@dt-only">
                <div class="o-sortingbox">
                    <!-- [data-sortingbox="true"]: 載入後自動綁定手機版排序客製樣式下拉功能 -->
                    <select class="o-sortingbox__input" data-sortingbox="true" data-sorting-linkto="hotTable">
                        <option value="">排序</option>
                        <option value="基金名稱高至低" data-sorting-column="ProductCode" data-sorting-class="is-desc">基金名稱高至低</option>
                        <option value="基金名稱低至高" data-sorting-column="ProductCode" data-sorting-class="is-asc">基金名稱低至高</option>
                        <option value="最新淨值高至低" data-sorting-column="NetAssetValue" data-sorting-class="is-desc">最新淨值高至低</option>
                        <option value="最新淨值低至高" data-sorting-column="NetAssetValue" data-sorting-class="is-asc">最新淨值低至高</option>
                        <option value="幣別高至低" data-sorting-column="ValuationCurrency" data-sorting-class="is-desc">幣別高至低</option>
                        <option value="幣別低至高" data-sorting-column="ValuationCurrency" data-sorting-class="is-asc">幣別低至高</option>
                        <option value="當日漲跌幅高至低" data-sorting-column="PercentageChangeInFundPrice" data-sorting-class="is-desc">當日漲跌幅高至低</option>
                        <option value="當日漲跌幅低至高" data-sorting-column="PercentageChangeInFundPrice" data-sorting-class="is-asc">當日漲跌幅低至高</option>
                        <option value="6個月績效高至低" data-sorting-column="SixMonthReturnOriginalCurrency" data-sorting-class="is-desc">6個月績效高至低</option>
                        <option value="6個月績效低至高" data-sorting-column="SixMonthReturnOriginalCurrency" data-sorting-class="is-asc">6個月績效低至高</option>
                        <option value="風險屬性高至低" data-sorting-column="RiskRewardLevel" data-sorting-class="is-desc">風險屬性高至低</option>
                        <option value="風險屬性低至高" data-sorting-column="RiskRewardLevel" data-sorting-class="is-asc">風險屬性低至高</option>
                    </select>
                </div>
            </div>
            <div class="l-flex__item">
                <div class="l-table">
                    <table class="c-table@dt-only c-cardTable@lt" data-table-name="hotTable">
                        <colgroup>
                            <col style="width: auto;">
                            <col style="width: 1%;">
                            <col style="width: 1%;">
                            <col style="width: 1%;">
                            <col style="width: 1%;">
                            <col style="width: 1%;">
                            <col style="width: 13%;">
                            <col style="width: 1%;">
                            <col style="width: 1%;">
                        </colgroup>
                        <thead>
                            <tr class="u-nowrap">
                                <th>
                                    <div class="c-table__title">
                                        <span>基金名稱</span>
                                        <!-- .is-asc: 升冪 -->
                                        <!-- .is-desc: 降冪 -->
                                        <a href="#" class="o-sorting" data-sorting-column="ProductCode"></a>
                                    </div>
                                </th>
                                <th>
                                    <div class="c-table__title">
                                        <span>最新淨值<br>(淨值日)</span>
                                        <a href="#" class="o-sorting" data-sorting-column="NetAssetValue"></a>
                                    </div>
                                </th>
                                <th>
                                    <div class="c-table__title">
                                        <span>幣別</span>
                                        <a href="#popupCurrency" class="o-icon o-icon--tip o-icon--xs" data-popup="true"></a>
                                        <a href="#" class="o-sorting" data-sorting-column="ValuationCurrency"></a>
                                    </div>
                                </th>
                                <th>
                                    <div class="c-table__title">
                                        <span>當日漲跌幅</span>
                                        <a href="#" class="o-sorting" data-sorting-column="PercentageChangeInFundPrice"></a>
                                    </div>
                                </th>
                                <th>
                                    <div class="c-table__title">
                                        <span>6個月績效</span>
                                        <a href="#" class="o-sorting is-desc" data-sorting-column="SixMonthReturnOriginalCurrency"></a>
                                    </div>
                                </th>
                                <th>
                                    <div class="c-table__title">
                                        <span>風險屬性</span>
                                        <a href="#" class="o-sorting" data-sorting-column="RiskRewardLevel"></a>
                                    </div>
                                </th>

                                <th>
                                    <div class="c-table__title">
                                        <span>關注/比較</span>
                                    </div>
                                </th>
                                <th>
                                    <div class="c-table__title">
                                        <span>申購</span>
                                    </div>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="result">
                            @foreach (var item in Model.HighRatedFunds)
                            {
                                if (item.ProductCode != null && item.ProductCode != "")
                                {
                                    <tr class="c-cardTable__item u-nowrap@dt-only u-center@dt-only" data-product-id="@item.ProductCode">
                                        <td class="c-cardTable__top"></td>
                                        <td class="c-cardTable__header u-wrap@dt-only u-left@dt-only">
                                            <div class="c-cardTable__content">
                                                <div class="l-target">
                                                    <div class="l-target__name">
                                                        <a href="#" class="o-contentLink t-bold u-ellipsis-2">@item.ProductCode @item.ProductName</a>
                                                    </div>
                                                    @if (item.TargetName == "Y")
                                                    {
                                                        <div class="l-target__additional">
                                                            <ul class="l-tag">
                                                                <li class="l-tag__item">
                                                                    <a href="#" class="o-tag">百元基金</a>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                    }
                                                </div>
                                            </div>
                                        </td>
                                        <td class="c-cardTable__space"></td>
                                        <td class="c-cardTable__body" data-card-table-width="1/2">
                                            <div class="c-cardTable__title" data-length="5">最新淨值<br>(淨值日)</div>
                                            <div class="c-cardTable__content">@item.NetAssetValue<br><span class="t-date">@item.NetAssetValueDate</span></div>
                                        </td>
                                        <td class="c-cardTable__body" data-card-table-width="1/2">
                                            <div class="c-cardTable__title" data-length="5">
                                                幣別
                                                <a href="#popupCurrency" class="o-icon o-icon--tip o-icon--xs" data-popup="true"></a>
                                            </div>
                                            <div class="c-cardTable__content">
                                                <a href="#" class="o-link">@item.ValuationCurrency</a>
                                            </div>
                                        </td>
                                        <td class="c-cardTable__body" data-card-table-width="1/2">
                                            <div class="c-cardTable__title" data-length="5">當日漲跌幅</div>
                                            <div class="c-cardTable__content">
                                                @if (item.PercentageChangeInFundPrice < 0)
                                                {
                                                    <span class="o-fall">@item.PercentageChangeInFundPrice%</span>
                                                }
                                                else
                                                {
                                                    <span class="o-rise">@item.PercentageChangeInFundPrice%</span>
                                                }
                                            </div>
                                        </td>
                                        <td class="c-cardTable__body" data-card-table-width="1/2">
                                            <div class="c-cardTable__title" data-length="5">6個月績效</div>
                                            <div class="c-cardTable__content">
                                                @if (item.SixMonthReturnOriginalCurrency < 0)
                                                {
                                                    <span class="o-fall">@item.SixMonthReturnOriginalCurrency%</span>
                                                }
                                                else
                                                {
                                                    <span class="o-rise">@item.SixMonthReturnOriginalCurrency%</span>
                                                }
                                            </div>
                                        </td>
                                        <td class="c-cardTable__body" data-card-table-width="1/2">
                                            <div class="c-cardTable__title" data-length="5">風險屬性</div>
                                            <div class="c-cardTable__content">@item.RiskRewardLevel</div>
                                        </td>
                                        <td class="c-cardTable__space"></td>
                                        <td class="c-cardTable__footer" data-card-table-width="2/3">
                                            <div class="c-cardTable__content">
                                                <ul class="l-collect l-collect--divider@lt">
                                                    <li class="l-collect__item">
                                                        <a href="#" class="o-statusBtn o-statusBtn--like" data-after-lt="關注" data-msg="加入關注|取消關注" data-ia="true"></a>
                                                    </li>
                                                    <li class="l-collect__item">
                                                        <a href="#" class="o-statusBtn o-statusBtn--compare" data-after-lt="比較" data-msg="加入比較|取消比較" data-ia="true"></a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </td>
                                        <td class="c-cardTable__footer" data-card-table-width="1/3">
                                            <div class="c-cardTable__content"><a href="#popupPurchase" class="o-tableBtn o-tableBtn--card@lt" data-popup="true">申購</a></div>
                                        </td>
                                    </tr>
                                }
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="l-sharebar">
    <div class="l-sharebar__wrap">
        <div class="l-sharebar__content">
            <div class="l-flex l-flex--inline u-flex-gap-sm">
                <div class="l-flex__item">
                    <a href="#" class="o-statusBtn o-statusBtn--btn o-statusBtn--tool" data-after="加入常用" data-text-on="已加入" data-msg="加入常用工具|移出常用工具" data-ia="true" data-ia-tooltip="false"></a>
                </div>
                <div class="l-flex__item">
                    <!-- [data-popover]: 彈跳視窗功能，值為彈跳視窗的 selector -->
                    <a href="#" class="o-btn o-btn--primary o-btn--icon" data-popover="#popoverFundHotSelectShare02">
                        <img src="./../themes/images/icons/white/share.svg" alt="分享">分享
                    </a>
                    <div id="popoverFundHotSelectShare02" class="c-popover c-popover--auto u-left">
                        <div class="c-popover__wrap">
                            <nav class="c-popover__main">
                                <ul class="l-flex u-flex-col u-flex-gap-md s4">
                                    <li class="l-flex__item">
                                        <a href="https://www.facebook.com/sharer/sharer.php?u=" class="o-social o-social--sm o-social--fb" target="_blank" data-share>
                                            <span class="u-hidden@mb-only">Facebook</span>
                                        </a>
                                    </li>
                                    <li class="l-flex__item">
                                        <a href="https://social-plugins.line.me/lineit/share?url=" class="o-social o-social--sm o-social--line" target="_blank" data-share>
                                            <span class="u-hidden@mb-only">LINE</span>
                                        </a>
                                    </li>
                                    <li class="l-flex__item">
                                        <div class="l-copy" data-copy>
                                            <div class="l-copy__action">
                                                <a href="#" class="o-social o-social--sm o-social--copy" data-copy-action>
                                                    <span class="u-hidden@mb-only">複製網址</span>
                                                </a>
                                            </div>
                                            <div class="l-copy__msg">
                                                <div class="o-tooltip o-tooltip--relative o-tooltip--top" data-copy-msg>
                                                    <div class="o-tooltip__content u-nowrap">已複製</div>
                                                    <div class="o-tooltip__arrow"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div><!-- [data-collapse="true"]: 綁定開合功能 -->
<div class="c-notice" data-collapse="true">
    <div class="c-notice__wrap">
        <div class="c-notice__outer" data-collapse-content="true">
            <div class="c-notice__inner">
                <div class="c-notice__title">附註</div>
                <div class="c-notice__content">
                    @Html.Sitecore().Field(HighRatedFundModel.Template.HighRatedFund.Fields.NoteContent.ToString(), modelitem)
                </div>
            </div>
        </div>
        <div class="c-notice__actions">
            <a href="#" class="c-notice__btn" data-collapse-button="true" data-collapse="收合" data-expand="展開"></a>
        </div>
    </div>
</div>

<div id="popupPurchase" class="c-modal c-modal--sm mfp-hide">
    <div class="c-modal__wrap">
        <header class="c-modal__header">
            <h2 class="c-modal__title">立即申購</h2>
        </header>
        <div class="c-modal__content">
            <div class="u-hidden@lt-up">
                <div class="l-flex u-flex-col u-flex-gap-xs">
                    <div class="l-flex__item">
                        <span class="t-bold">選擇申購平台：</span>
                    </div>
                    <div class="l-flex__item">
                        <div class="l-pickGroup">
                            <div class="l-pickGroup__item">
                                <label class="o-btnRadio">
                                    <input class="o-btnRadio__input" type="radio" name="platform" checked>
                                    <div class="o-btnRadio__text"><span>第e行動</span></div>
                                </label>
                            </div>
                            <div class="l-pickGroup__item">
                                <label class="o-btnRadio">
                                    <input class="o-btnRadio__input" type="radio" name="platform">
                                    <div class="o-btnRadio__text"><span>iLEO</span></div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="c-modal__action">
            <div class="l-action l-action--inline">
                <div class="l-action__item">
                    <a href="#" class="o-btn o-btn--primary o-btn--sm">單筆申購</a>
                </div>
                <div class="l-action__item">
                    <a href="#" class="o-btn o-btn--primary o-btn--sm">定期定額</a>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="popupCurrency" class="c-modal c-modal--xs mfp-hide">
    <div class="c-modal__wrap">
        <header class="c-modal__header">
            <h2 class="c-modal__title">幣別提示說明</h2>
        </header>
        <div class="c-modal__content">
            <p>點擊幣別可查詢相關匯率</p>
        </div>
    </div>
</div>

<script>
    (function ($, window, document, undefined) {
        document.addEventListener('DOMContentLoaded', function () {
            if (!jQuery) {
                return;
            }

            function ReturnSortView(orderby, desc) {
                $.ajax({
                    url: '@ClientRoute.GenerateUrl(this, "HighRatedFund", "GetSortedHighRatedFund")',
                    type: 'POST',
                    data: { orderby: orderby, desc: desc },
                    success: function (data) {
                        $('#result').empty();
                        $('#result').html(data);
                        Removefall();
                    },
                    error: function (xhr, status, error) {
                        console.error(error);
                    }
                });

            }

            Removefall();
            function Removefall() {
                $('span.o-fall').each(function () {
                    var content = $(this).text();
                    if (content.startsWith('-')) {
                        var number = content.substring(1);
                        $(this).text(number);
                    }
                });
            }

            $('table').off('click.sorting').on('click.sorting', '.o-sorting', function (e) {
                e.preventDefault();
                // 呼叫 loading
                window.loading('show');
                var $this = $(this);
                var orderby = '';
                if ($this.hasClass('is-asc')) {
                    $this.removeClass('is-asc').addClass('is-desc');
                    orderby = 'is-desc';
                }
                else {
                    $this.closest('.l-table').find('.o-sorting').removeClass('is-asc is-desc');
                    $this.addClass('is-asc');
                    orderby = 'is-asc';
                }

                var sortingColumn = $this.data('sorting-column');

                // 連動 sortingbox
                var tableName = $(this).closest('[data-table-name]').data('table-name');
                var $sortingbox = $(`[data-sorting-linkto="${tableName}"]`);
                var sortingColumn = $(this).data('sorting-column');
                $(`option[data-sorting-column="${sortingColumn}"][data-sorting-class="${orderby}"]`, $sortingbox).prop('selected', true);
                $sortingbox.trigger('change');

                // 因展示，使用 setTimeout 延遲關閉 loading
                setTimeout(() => {
                    // 關閉loading
                    window.loading('hide');
                }, 300);
            });


            // 手機版分頁筆數功能
            $('[data-sortingbox="true"]').on('change.sorting', function (e) {
                // 呼叫 loading
                window.loading('show');
                var sorting = $(this).val();
                var $linkTable = $(`[data-table-name="${$(this).data('sorting-linkto')}"]`);
                var sortingColumn = $('option:selected', this).data('sorting-column');
                var orderby = $('option:selected', this).data('sorting-class');

                // 連動 table
                $('.o-sorting', $linkTable).removeClass('is-asc is-desc');
                $(`[data-sorting-column="${sortingColumn}"]`, $linkTable).addClass(orderby);
                console.log(`排序：${sorting}`);


                ReturnSortView(sortingColumn, orderby)

                // 因展示，使用 setTimeout 延遲關閉 loading
                setTimeout(() => {
                    // 關閉loading
                    window.loading('hide');
                }, 300);
            });

        });

    })(jQuery, window, document);
</script>



@model Feature.Wealth.Component.Models.Calculate.CalculateModel
@using Feature.Wealth.Component.Models.Calculate;
@using Feature.Wealth.Account.Helpers;
@using Foundation.Wealth.Helper;
@using Sitecore.Configuration;

@if (Model == null)
{
    return;
}

@{
    var isLogin = FcbMemberHelper.CheckMemberLogin();
    var WebKycLink = Settings.GetSetting("WebKYC");
    var FirsteKycLink = Settings.GetSetting("FirsteKYC");
    var IleoKycLink = Settings.GetSetting("IleoKYC");
}

<!-- 退休準備試算_描述區塊 -->
<div class="c-section" id="calculateDescription">
    <div class="l-wrap">
        <div class="l-minorstage">
            <div class="l-minorstage__content">
                <div class="l-flex u-flex-col u-flex-gap-sm u-flex-top">
                    @if (!string.IsNullOrEmpty(Model.MainTitle))
                    {
                        <div class="t2 t-bold">@Model.MainTitle</div>
                    }

                    @if (!string.IsNullOrEmpty(Model.MainContent))
                    {
                        @Html.Sitecore().Field(Template.Calculate.Fields.MainContent.ToString(), Model.Datasource)
                    }
                </div>
            </div>

            @if (!string.IsNullOrEmpty(Model.Image))
            {
                <div class="l-minorstage__img">
                    <img src="@Model.Image" alt="">
                </div>
            }
        </div>
    </div>
</div>

<!-- 退休準備試算_主要區塊-->
<div class="c-section" id="calculateMain">
    <div class="l-wrap">
        <div class="l-formWrap l-formWrap--trial">
            <div class="l-formBlock l-formBlock--trial">
                <div class="l-formBlock__group">
                    <div class="l-formBlock__title">
                        <span class="t2 t-bold">目標規劃</span>
                    </div>
                    <div class="l-formBlock__item">
                        <div class="c-form c-form--trial">
                            <div class="c-form__content">
                                <div class="l-form" id="yearForm">
                                    <div class="l-form__content">
                                        <div class="l-ageForm">
                                            <div class="l-ageForm__items">
                                                <span class="l-ageForm__title s3 t-bold">現在</span>
                                                <div class="l-ageForm__box">
                                                    <div class="o-unitbox">
                                                        <input id="yearBegin" type="number" value="40" class="o-unitbox__input o-unitbox__input--full o-unitbox__input--calc" data-id="yearBegin"
                                                               oninput="if(!/^\d*\.?\d*$/.test(this.value)) this.value = this.value.slice(0, -1)"
                                                               onkeydown="return (event.key === 'Backspace' || event.key === 'Delete' || (event.key >= '0' && event.key <= '9') || (event.key >= 'Numpad0' && event.key <= 'Numpad9') || event.key === 'ArrowLeft' || event.key === 'ArrowRight' || event.key === 'Tab' || event.key === 'Enter' || event.ctrlKey || event.metaKey)">
                                                        <span class="o-unitbox__text">歲</span>
                                                    </div>
                                                </div>
                                                <span class="l-ageForm__title s3 t-bold">預計</span>
                                                <div class="l-ageForm__box">
                                                    <div class="o-unitbox">
                                                        <input id="yearEnd" type="number" value="65" class="o-unitbox__input o-unitbox__input--full o-unitbox__input--calc" data-id="yearEnd"
                                                               oninput="if(!/^\d*\.?\d*$/.test(this.value)) this.value = this.value.slice(0, -1)"
                                                               onkeydown="return (event.key === 'Backspace' || event.key === 'Delete' || (event.key >= '0' && event.key <= '9') || (event.key >= 'Numpad0' && event.key <= 'Numpad9') || event.key === 'ArrowLeft' || event.key === 'ArrowRight' || event.key === 'Tab' || event.key === 'Enter' || event.ctrlKey || event.metaKey)">
                                                        <span class="o-unitbox__text">歲</span>
                                                    </div>
                                                </div>
                                                <span class="l-ageForm__suffix s3 t-bold">退休</span>
                                            </div>
                                            <div class="l-ageForm__slider">
                                                <div class="c-sliderBar c-sliderBar--flat">
                                                    <div class="c-sliderBar__main" data-slider-id="year"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="l-form__text l-form__text--error">
                                        <div class="o-errorText">
                                            <span class="s4" id="yearErrorText"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="l-formBlock__item">
                        <div class="c-form c-form--trial">
                            <div class="c-form__title">
                                預期壽命
                                <a href="#popupLifespan" class="o-icon o-icon--tip o-icon--xs" data-popup="true"></a>
                            </div>
                            <div class="c-form__content">
                                <div class="l-form" id="lifeExpectancyForm">
                                    <div class="l-form__set">
                                        <div class="l-form__input">
                                            <div class="o-unitbox">
                                                <input id="lifeExpectancy" type="number" value="83" class="o-unitbox__input o-unitbox__input--full o-unitbox__input--calc"
                                                       oninput="if(!/^\d*\.?\d*$/.test(this.value)) this.value = this.value.slice(0, -1)"
                                                       onkeydown="return (event.key === 'Backspace' || event.key === 'Delete' || (event.key >= '0' && event.key <= '9') || (event.key >= 'Numpad0' && event.key <= 'Numpad9') || event.key === 'ArrowLeft' || event.key === 'ArrowRight' || event.key === 'Tab' || event.key === 'Enter' || event.ctrlKey || event.metaKey)">
                                                <span class="o-unitbox__text">歲</span>
                                            </div>
                                        </div>
                                        <div id="payExpenses">
                                            退休後須支應 <span id="payExpensesVal">18</span> 年的花費
                                        </div>
                                    </div>
                                    <div class="l-form__text l-form__text--error">
                                        <div class="o-errorText">
                                            <span class="s4" id="lifeExpectancyErrorText"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="l-formBlock__item">
                        <div class="c-form c-form--trial">
                            <div class="c-form__title">現階段每月花費</div>
                            <div class="c-form__content">
                                <div class="l-form" id="currentMonthlyCostForm">
                                    <div class="l-form__input">
                                        <div class="o-unitbox">
                                            <input id="currentMonthlyCost" type="number" value="6" class="o-unitbox__input o-unitbox__input--full o-unitbox__input--calc"
                                                   oninput="if(!/^\d*\.?\d*$/.test(this.value)) this.value = this.value.slice(0, -1)"
                                                   onkeydown="return (event.key === '.' || event.key === 'Backspace' || event.key === 'Delete' || (event.key >= '0' && event.key <= '9') || (event.key >= 'Numpad0' && event.key <= 'Numpad9') || event.key === 'ArrowLeft' || event.key === 'ArrowRight' || event.key === 'Tab' || event.key === 'Enter' || event.ctrlKey || event.metaKey)">
                                            <span class="o-unitbox__text">萬元</span>
                                        </div>
                                    </div>
                                    <div class="l-form__text l-form__text--error">
                                        <div class="o-errorText">
                                            <span class="s4" id="currentMonthlyCostErrorText"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="l-formBlock__item">
                        <div class="c-form c-form--trial">
                            <div class="c-form__title">
                                退休後每月花費(家庭)
                                <a href="#popupExpenses" class="o-icon o-icon--tip o-icon--xs" data-popup="true"></a>
                            </div>
                            <div class="c-form__content">
                                <div class="l-form" id="retireMonthlyCostForm">
                                    <div class="l-form__input">
                                        <div class="o-unitbox">
                                            <input id="retireMonthlyCost" type="number" value="4.2" class="o-unitbox__input o-unitbox__input--full o-unitbox__input--calc"
                                                   oninput="if(!/^\d*\.?\d*$/.test(this.value)) this.value = this.value.slice(0, -1)"
                                                   onkeydown="return (event.key === '.' || event.key === 'Backspace' || event.key === 'Delete' || (event.key >= '0' && event.key <= '9') || (event.key >= 'Numpad0' && event.key <= 'Numpad9') || event.key === 'ArrowLeft' || event.key === 'ArrowRight' || event.key === 'Tab' || event.key === 'Enter' || event.ctrlKey || event.metaKey)">
                                            <span class="o-unitbox__text">萬元</span>
                                        </div>
                                    </div>
                                    <div class="l-form__text l-form__text--error">
                                        <div class="o-errorText">
                                            <span class="s4" id="retireMonthlyCostErrorText"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="l-formBlock__group">
                    <div class="l-formBlock__title">
                        <span class="t2 t-bold">投資規劃</span>
                    </div>
                    <div class="l-formBlock__item">
                        <div class="c-form c-form--trial">
                            <div class="c-form__title">已準備金額</div>
                            <div class="c-form__content">
                                <div class="l-form" id="amountPreparedForm">
                                    <div class="l-form__input">
                                        <div class="o-unitbox">
                                            <input id="amountPrepared" type="number" value="0" class="o-unitbox__input o-unitbox__input--full o-unitbox__input--calc"
                                                   oninput="if(!/^\d*\.?\d*$/.test(this.value)) this.value = this.value.slice(0, -1)"
                                                   onkeydown="return (event.key === '.' || event.key === 'Backspace' || event.key === 'Delete' || (event.key >= '0' && event.key <= '9') || (event.key >= 'Numpad0' && event.key <= 'Numpad9') || event.key === 'ArrowLeft' || event.key === 'ArrowRight' || event.key === 'Tab' || event.key === 'Enter' || event.ctrlKey || event.metaKey)">
                                            <span class="o-unitbox__text">萬元</span>
                                        </div>
                                    </div>
                                    <div class="l-form__text l-form__text--error">
                                        <div class="o-errorText">
                                            <span class="s4" id="amountPreparedErrorText"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="l-formBlock__item">
                        <div class="c-form c-form--trial">
                            <div class="c-form__title">
                                預估法定退休金
                                <a href="#popupPension" class="o-icon o-icon--tip o-icon--xs" data-popup="true"></a>
                            </div>
                            <div class="c-form__content">
                                <div class="l-form" id="pensionForm">
                                    <div class="l-form__input">
                                        <div class="o-unitbox">
                                            <input id="pension" type="number" value="500" class="o-unitbox__input o-unitbox__input--full o-unitbox__input--calc"
                                                   oninput="if(!/^\d*\.?\d*$/.test(this.value)) this.value = this.value.slice(0, -1)"
                                                   onkeydown="return (event.key === '.' || event.key === 'Backspace' || event.key === 'Delete' || (event.key >= '0' && event.key <= '9') || (event.key >= 'Numpad0' && event.key <= 'Numpad9') || event.key === 'ArrowLeft' || event.key === 'ArrowRight' || event.key === 'Tab' || event.key === 'Enter' || event.ctrlKey || event.metaKey)">
                                            <span class="o-unitbox__text">萬元</span>
                                        </div>
                                    </div>
                                    <div class="l-form__text l-form__text--error">
                                        <div class="o-errorText">
                                            <span class="s4" id="pensionErrorText"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="l-formBlock__item">
                        <div class="c-form c-form--trial">
                            <div class="c-form__title">每月投入金額</div>
                            <div class="c-form__content">
                                <div class="l-form" id="monthlyInvestmentForm">
                                    <div class="l-form__input">
                                        <div class="o-unitbox">
                                            <input id="monthlyInvestment" type="number" value="1" class="o-unitbox__input o-unitbox__input--full o-unitbox__input--calc" data-id="monthly"
                                                   oninput="if(!/^\d*\.?\d*$/.test(this.value)) this.value = this.value.slice(0, -1)"
                                                   onkeydown="return (event.key === '.' || event.key === 'Backspace' || event.key === 'Delete' || (event.key >= '0' && event.key <= '9') || (event.key >= 'Numpad0' && event.key <= 'Numpad9') || event.key === 'ArrowLeft' || event.key === 'ArrowRight' || event.key === 'Tab' || event.key === 'Enter' || event.ctrlKey || event.metaKey)">
                                            <span class="o-unitbox__text">萬元</span>
                                        </div>
                                    </div>
                                    <div class="l-form__text l-form__text--error">
                                        <div class="o-errorText">
                                            <span class="s4" id="monthlyInvestmentErrorText"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="l-formBlock__item">
                        <div class="c-form c-form--trial">
                            <div class="c-form__title">
                                預期投資報酬率
                                <a href="#popupRoi" class="o-icon o-icon--tip o-icon--xs" data-popup="true"></a>
                            </div>
                            <div class="c-form__content">
                                <div class="l-form">
                                    <div class="l-form__set">
                                        <div class="l-form__input">
                                            <div class="o-unitbox">
                                                <input id="expectedRoi" type="number" value="2.00" class="o-unitbox__input o-unitbox__input--full o-unitbox__input--calc" data-id="roi"
                                                       oninput="if(!/^\d*\.?\d*$/.test(this.value)) this.value = this.value.slice(0, -1)"
                                                       onkeydown="return (event.key === '.' || event.key === 'Backspace' || event.key === 'Delete' || (event.key >= '0' && event.key <= '9') || (event.key >= 'Numpad0' && event.key <= 'Numpad9') || event.key === 'ArrowLeft' || event.key === 'ArrowRight' || event.key === 'Tab' || event.key === 'Enter' || event.ctrlKey || event.metaKey)">
                                                <span class="o-unitbox__text">％</span>
                                            </div>
                                        </div>
                                        <div class="l-form__input l-form__input--extra">
                                            <div class="c-sliderBar c-sliderBar--flat">
                                                <div class="c-sliderBar__main" data-slider-id="roi"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="l-form__text l-form__text--error">
                                        <div class="o-errorText">
                                            <span class="s4"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="l-formBlock__action">
                        <button data-gotop id="Calculate" type="button" class="o-btn o-btn--primary o-btn--lg">開始試算</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 預期壽命彈窗內容 -->
<div id="popupLifespan" class="c-modal c-modal--xs mfp-hide">
    <div class="c-modal__wrap">
        @if (!string.IsNullOrEmpty(Model.LifeExpectancyTipTitle))
        {
            <header class="c-modal__header">
                <h2 class="c-modal__title">@Model.LifeExpectancyTipTitle</h2>
            </header>
        }

        @if (!string.IsNullOrEmpty(Model.LifeExpectancyTipContent))
        {
            <div class="c-modal__content">
                <p>@Model.LifeExpectancyTipContent</p>
            </div>
        }
    </div>
</div>

<!-- 退休後每月花費(家庭)彈窗內容 -->
<div id="popupExpenses" class="c-modal c-modal--xs mfp-hide">
    <div class="c-modal__wrap">
        @if (!string.IsNullOrEmpty(Model.RetirementExpensesTipTitle))
        {
            <header class="c-modal__header">
                <h2 class="c-modal__title">@Model.RetirementExpensesTipTitle</h2>
            </header>
        }

        @if (!string.IsNullOrEmpty(Model.RetirementExpensesTipContent))
        {
            <div class="c-modal__content">
                <p>@Model.RetirementExpensesTipContent</p>
            </div>
        }
    </div>
</div>

<!-- 預估法定退休金彈窗內容 -->
<div id="popupPension" class="c-modal c-modal--xs mfp-hide">
    <div class="c-modal__wrap">
        @if (!string.IsNullOrEmpty(Model.EstimatedPensionTipTitle))
        {
            <header class="c-modal__header">
                <h2 class="c-modal__title">@Model.EstimatedPensionTipTitle</h2>
            </header>
        }

        @if (!string.IsNullOrEmpty(Model.EstimatedPensionTipContent))
        {
            <div class="c-modal__content">
                <p>@Model.EstimatedPensionTipContent</p>
            </div>
        }
    </div>
</div>

<!-- 預期投資報酬率彈窗內容 -->
<div id="popupRoi" class="c-modal c-modal--xs mfp-hide">
    <div class="c-modal__wrap">
        @if (!string.IsNullOrEmpty(Model.AnticipatedInvestmentTipTitle))
        {
            <header class="c-modal__header">
                <h2 class="c-modal__title">@Model.AnticipatedInvestmentTipTitle</h2>
            </header>
        }

        @if (!string.IsNullOrEmpty(Model.AnticipatedInvestmentTipContent))
        {
            <div class="c-modal__content">
                <p>@Model.AnticipatedInvestmentTipContent</p>
            </div>
        }
    </div>
</div>

<!-- 重新試算彈窗 -->
<div id="popupAdjustment" class="c-modal c-modal--sm mfp-hide">
    <div class="c-modal__wrap">
        <header class="c-modal__header">
            <h2 class="c-modal__title">調整我的規劃</h2>
        </header>
        <div class="c-modal__content">
            <form class="l-formBlock l-formBlock--popup">
                <div class="l-formBlock__group">
                    <div class="l-formBlock__title">
                        <span class="t2 t-bold">目標規劃</span>
                    </div>
                    <div class="l-formBlock__item">
                        <div class="c-form c-form--popup">
                            <div class="c-form__content">
                                <div class="l-form l-form--popup" id="year_PopupForm">
                                    <div class="l-form__content">
                                        <div class="l-ageForm l-ageForm--popup">
                                            <div class="l-ageForm__items">
                                                <span class="l-ageForm__title s3 t-bold">現在</span>
                                                <div class="l-ageForm__box">
                                                    <div class="o-unitbox">
                                                        <input id="yearBegin_Popup" type="number" value="40" class="o-unitbox__input o-unitbox__input--full o-unitbox__input--calc" data-id="yearbegin_popup"
                                                               oninput="if(!/^\d*\.?\d*$/.test(this.value)) this.value = this.value.slice(0, -1)"
                                                               onkeydown="return (event.key === 'Backspace' || event.key === 'Delete' || (event.key >= '0' && event.key <= '9') || (event.key >= 'Numpad0' && event.key <= 'Numpad9') || event.key === 'ArrowLeft' || event.key === 'ArrowRight' || event.key === 'Tab' || event.key === 'Enter' || event.ctrlKey || event.metaKey)">
                                                        <span class="o-unitbox__text">歲</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="l-ageForm__items">
                                                <span class="l-ageForm__title s3 t-bold">預計</span>
                                                <div class="l-ageForm__box">
                                                    <div class="o-unitbox">
                                                        <input id="yearEnd_Popup" type="number" value="65" class="o-unitbox__input o-unitbox__input--full o-unitbox__input--calc" data-id="yearend_popup"
                                                               oninput="if(!/^\d*\.?\d*$/.test(this.value)) this.value = this.value.slice(0, -1)"
                                                               onkeydown="return (event.key === 'Backspace' || event.key === 'Delete' || (event.key >= '0' && event.key <= '9') || (event.key >= 'Numpad0' && event.key <= 'Numpad9') || event.key === 'ArrowLeft' || event.key === 'ArrowRight' || event.key === 'Tab' || event.key === 'Enter' || event.ctrlKey || event.metaKey)">
                                                        <span class="o-unitbox__text">歲</span>
                                                    </div>
                                                </div>
                                                <span class="l-ageForm__suffix s3 t-bold">退休</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="l-form__text l-form__text--error">
                                        <div class="o-errorText">
                                            <span class="s4" id="year_PopupErrorText"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="l-formBlock__item">
                        <div class="c-form c-form--popup">
                            <div class="c-form__title">預期壽命</div>
                            <div class="c-form__content">
                                <div class="l-form l-form--popup" id="lifeExpectancy_PopupForm">
                                    <div class="l-form__input">
                                        <div class="o-unitbox">
                                            <input id="lifeExpectancy_Popup" type="number" value="83" class="o-unitbox__input o-unitbox__input--full o-unitbox__input--calc"
                                                   oninput="if(!/^\d*\.?\d*$/.test(this.value)) this.value = this.value.slice(0, -1)"
                                                   onkeydown="return (event.key === 'Backspace' || event.key === 'Delete' || (event.key >= '0' && event.key <= '9') || (event.key >= 'Numpad0' && event.key <= 'Numpad9') || event.key === 'ArrowLeft' || event.key === 'ArrowRight' || event.key === 'Tab' || event.key === 'Enter' || event.ctrlKey || event.metaKey)">
                                            <span class="o-unitbox__text">歲</span>
                                        </div>
                                        <div id="payExpenses_Popup">
                                            退休後須支應 <span id="payExpensesVal_Popup">18</span> 年的花費
                                        </div>
                                    </div>
                                    <div class="l-form__text l-form__text--error">
                                        <div class="o-errorText">
                                            <span class="s4" id="lifeExpectancy_PopupErrorText"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="l-formBlock__item">
                        <div class="c-form c-form--popup">
                            <div class="c-form__title">現階段每月花費</div>
                            <div class="c-form__content">
                                <div class="l-form l-form--popup" id="currentMonthlyCost_PopupForm">
                                    <div class="l-form__input">
                                        <div class="o-unitbox">
                                            <input id="currentMonthlyCost_Popup" type="number" value="6" class="o-unitbox__input o-unitbox__input--full o-unitbox__input--calc"
                                                   oninput="if(!/^\d*\.?\d*$/.test(this.value)) this.value = this.value.slice(0, -1)"
                                                   onkeydown="return (event.key === '.' || event.key === 'Backspace' || event.key === 'Delete' || (event.key >= '0' && event.key <= '9') || (event.key >= 'Numpad0' && event.key <= 'Numpad9') || event.key === 'ArrowLeft' || event.key === 'ArrowRight' || event.key === 'Tab' || event.key === 'Enter' || event.ctrlKey || event.metaKey)">
                                            <span class="o-unitbox__text">萬元</span>
                                        </div>
                                    </div>
                                    <div class="l-form__text l-form__text--error">
                                        <div class="o-errorText">
                                            <span class="s4" id="currentMonthlyCost_PopupErrorText"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="l-formBlock__item">
                        <div class="c-form c-form--popup">
                            <div class="c-form__title">退休後每月花費(家庭)</div>
                            <div class="c-form__content">
                                <div class="l-form l-form--popup" id="retireMonthlyCost_PopupForm">
                                    <div class="l-form__input">
                                        <div class="o-unitbox">
                                            <input id="retireMonthlyCost_Popup" type="number" value="4.2" class="o-unitbox__input o-unitbox__input--full o-unitbox__input--calc"
                                                   oninput="if(!/^\d*\.?\d*$/.test(this.value)) this.value = this.value.slice(0, -1)"
                                                   onkeydown="return (event.key === '.' || event.key === 'Backspace' || event.key === 'Delete' || (event.key >= '0' && event.key <= '9') || (event.key >= 'Numpad0' && event.key <= 'Numpad9') || event.key === 'ArrowLeft' || event.key === 'ArrowRight' || event.key === 'Tab' || event.key === 'Enter' || event.ctrlKey || event.metaKey)">
                                            <span class="o-unitbox__text">萬元</span>
                                        </div>
                                    </div>
                                    <div class="l-form__text l-form__text--error">
                                        <div class="o-errorText">
                                            <span class="s4" id="retireMonthlyCost_PopupErrorText"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="l-formBlock__group">
                    <div class="l-formBlock__title">
                        <span class="t2 t-bold">投資規劃</span>
                    </div>
                    <div class="l-formBlock__item">
                        <div class="c-form c-form--popup">
                            <div class="c-form__title">已準備金額</div>
                            <div class="c-form__content">
                                <div class="l-form l-form--popup" id="amountPrepared_PopupForm">
                                    <div class="l-form__input">
                                        <div class="o-unitbox">
                                            <input id="amountPrepared_Popup" type="number" value="0" class="o-unitbox__input o-unitbox__input--full o-unitbox__input--calc"
                                                   oninput="if(!/^\d*\.?\d*$/.test(this.value)) this.value = this.value.slice(0, -1)"
                                                   onkeydown="return (event.key === '.' || event.key === 'Backspace' || event.key === 'Delete' || (event.key >= '0' && event.key <= '9') || (event.key >= 'Numpad0' && event.key <= 'Numpad9') || event.key === 'ArrowLeft' || event.key === 'ArrowRight' || event.key === 'Tab' || event.key === 'Enter' || event.ctrlKey || event.metaKey)">
                                            <span class="o-unitbox__text">萬元</span>
                                        </div>
                                    </div>
                                    <div class="l-form__text l-form__text--error">
                                        <div class="o-errorText">
                                            <span class="s4" id="amountPrepared_PopupErrorText"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="l-formBlock__item">
                        <div class="c-form c-form--popup">
                            <div class="c-form__title">預估法定退休金</div>
                            <div class="c-form__content">
                                <div class="l-form l-form--popup" id="pension_PopupForm">
                                    <div class="l-form__input">
                                        <div class="o-unitbox">
                                            <input id="pension_Popup" type="number" value="500" class="o-unitbox__input o-unitbox__input--full o-unitbox__input--calc"
                                                   oninput="if(!/^\d*\.?\d*$/.test(this.value)) this.value = this.value.slice(0, -1)"
                                                   onkeydown="return (event.key === '.' || event.key === 'Backspace' || event.key === 'Delete' || (event.key >= '0' && event.key <= '9') || (event.key >= 'Numpad0' && event.key <= 'Numpad9') || event.key === 'ArrowLeft' || event.key === 'ArrowRight' || event.key === 'Tab' || event.key === 'Enter' || event.ctrlKey || event.metaKey)">
                                            <span class="o-unitbox__text">萬元</span>
                                        </div>
                                    </div>
                                    <div class="l-form__text l-form__text--error">
                                        <div class="o-errorText">
                                            <span class="s4" id="pension_PopupErrorText"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="l-formBlock__item">
                        <div class="c-form c-form--popup">
                            <div class="c-form__title">每月投入金額</div>
                            <div class="c-form__content">
                                <div class="l-form l-form--popup" id="monthlyInvestment_PopupForm">
                                    <div class="l-form__input">
                                        <div class="o-unitbox">
                                            <input id="monthlyInvestment_Popup" type="number" value="1" class="o-unitbox__input o-unitbox__input--full o-unitbox__input--calc" data-id="popup_monthly"
                                                   oninput="if(!/^\d*\.?\d*$/.test(this.value)) this.value = this.value.slice(0, -1)"
                                                   onkeydown="return (event.key === '.' || event.key === 'Backspace' || event.key === 'Delete' || (event.key >= '0' && event.key <= '9') || (event.key >= 'Numpad0' && event.key <= 'Numpad9') || event.key === 'ArrowLeft' || event.key === 'ArrowRight' || event.key === 'Tab' || event.key === 'Enter' || event.ctrlKey || event.metaKey)">
                                            <span class="o-unitbox__text">萬元</span>
                                        </div>
                                    </div>
                                    <div class="l-form__text l-form__text--error">
                                        <div class="o-errorText">
                                            <span class="s4" id="monthlyInvestment_PopupErrorText"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="l-formBlock__item">
                        <div class="c-form c-form--popup">
                            <div class="c-form__title">預期投資報酬率</div>
                            <div class="c-form__content">
                                <div class="l-form l-form--popup">
                                    <div class="l-form__input">
                                        <div class="o-unitbox">
                                            <input id="expectedRoi_Popup" type="number" value="2.00" class="o-unitbox__input o-unitbox__input--full o-unitbox__input--calc" data-id="popup_roi"
                                                   oninput="if(!/^\d*\.?\d*$/.test(this.value)) this.value = this.value.slice(0, -1)"
                                                   onkeydown="return (event.key === '.' || event.key === 'Backspace' || event.key === 'Delete' || (event.key >= '0' && event.key <= '9') || (event.key >= 'Numpad0' && event.key <= 'Numpad9') || event.key === 'ArrowLeft' || event.key === 'ArrowRight' || event.key === 'Tab' || event.key === 'Enter' || event.ctrlKey || event.metaKey)">
                                            <span class="o-unitbox__text">%</span>
                                        </div>
                                    </div>
                                    <div class="l-form__text l-form__text--error">
                                        <div class="o-errorText">
                                            <span class="s4"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="l-formBlock__action">
                        <button data-gotop id="Recalculate" type="button" class="o-btn o-btn--primary o-btn--lg">重新試算</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- 退休準備試算結果_描述區塊 -->
<div class="l-mainstage u-hidden" id="resultDescription">
    <div class="l-mainstage__wrap">
        <div class="l-mainstage__title">
            <h1 class="t-title">退休準備試算結果</h1>
        </div>
        <div class="l-mainstage__content">
            <div class="l-calcResult">
                <div class="l-calcResult__content" id="resultContent"></div>

                <div class="l-calcResult__lecture u-hidden" id="resultSuccessMain">
                    <div class="c-calcLecture">
                        @if (!string.IsNullOrEmpty(Model.SuccessImage))
                        {
                            <div class="c-calcLecture__caption">
                                <img src="@Model.SuccessImage" class="c-calcLecture__img" alt="">
                            </div>
                        }

                        @if (!string.IsNullOrEmpty(Model.SuccessContent))
                        {
                            @Html.Sitecore().Field(Template.Calculate.Fields.SuccessContent.ToString(), Model.Datasource)
                        }

                    </div>
                </div>

                <div class="l-calcResult__lecture u-hidden" id="resultUnsuccessfulMain">
                    <div class="c-calcLecture">
                        @if (!string.IsNullOrEmpty(Model.UnsuccessfulImage))
                        {
                            <div class="c-calcLecture__caption">
                                <img src="@Model.UnsuccessfulImage" class="c-calcLecture__img" alt="">
                            </div>
                        }

                        @if (!string.IsNullOrEmpty(Model.UnsuccessfulContent))
                        {
                            @Html.Sitecore().Field(Template.Calculate.Fields.UnsuccessfulContent.ToString(), Model.Datasource)
                        }
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<!-- 退休準備試算結果_Tab區塊 -->
<section class="c-section c-section--tab u-hidden" id="resultTab">
    <div class="l-wrap">
        <div class="c-tab c-tab--wide" data-tab="true">
            <div class="c-tab__header">
                <ul class="c-tab__navs">
                    <li><a href="#" class="c-tab__item is-active tab1Btn u-hidden" target="_self" title="您的規劃" data-tab-target="tab-1">您的規劃</a></li>
                    <li><a href="#" class="c-tab__item tab2Btn u-hidden" target="_self" title="推薦方案 1" data-tab-target="tab-2">推薦方案 1</a></li>
                    <li><a href="#" class="c-tab__item tab3Btn u-hidden" target="_self" title="推薦方案 2" data-tab-target="tab-3">推薦方案 2</a></li>
                    <li><a href="#" class="c-tab__item tab4Btn u-hidden" target="_self" title="推薦方案 1" data-tab-target="tab-4">推薦方案 1</a></li>
                </ul>
                <div class="c-tab__collapse">
                    <a href="#" class="c-tab__switch"></a>
                    <div class="c-tab__dropdown">
                        <a href="#" class="c-tab__clone is-active tab1Btn u-hidden" target="_self" title="您的規劃" data-tab-target="tab-1">您的規劃</a>
                        <a href="#" class="c-tab__clone tab2Btn u-hidden" target="_self" title="推薦方案 1" data-tab-target="tab-2">推薦方案 1</a>
                        <a href="#" class="c-tab__clone tab3Btn u-hidden" target="_self" title="推薦方案 2" data-tab-target="tab-3">推薦方案 2</a>
                        <a href="#" class="c-tab__clone tab4Btn u-hidden" target="_self" title="推薦方案 1" data-tab-target="tab-4">推薦方案 1</a>
                    </div>
                </div>
            </div>
            <div class="c-tab__panel is-active" data-tab-panel-id="tab-1">
                <div class="c-section" id="tab1_earningsChart">
                    <div class="c-section">
                        <div class="c-section__title u-hidden earningsChartTitle">您的規劃</div>
                        <div class="c-section__content">
                            <div class="l-calcCard">
                                <div class="l-calcCard__head t-bold">
                                    <span class="t3">預期總收益</span>
                                    <span class="t1 t-warning" id="tab1_Total"></span>
                                </div>
                                <div class="l-calcCard__content">
                                    <div class="l-pipeList">
                                        <div class="l-pipeList__content">
                                            <ul class="c-pipeList s3 t-bold">
                                                <li class="c-pipeList__item ">
                                                    <span>法定退休金</span>
                                                    <span class="" id="tab1_Pension"></span>
                                                </li>
                                                <li class="c-pipeList__item ">
                                                    <span>每月投入</span>
                                                    <span class="" id="tab1_MonthlyInvestment"></span>
                                                </li>
                                                <li class="c-pipeList__item ">
                                                    <span>投資報酬率</span>
                                                    <span class="" id="tab1_ExpectedRoi"></span>
                                                </li>
                                                <li class="c-pipeList__item ">
                                                    <span>距離離退休還有</span>
                                                    <span class="" id="tab1_Years"></span>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="l-pipeList__actions">
                                            <a href="#popupAdjustment" class="o-btn o-btn--primary o-btn--sm o-btn--flat" data-popup="true">調整我的規劃</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 預期收益 & 投資報酬模擬 -->
                    <div class="c-section">
                        <div class="l-revenueResult">
                            <div class="l-revenueResult__charts">
                                <div class="l-calcCharts">
                                    <div class="l-calcCharts__item l-calcCharts__item--1of3">
                                        <div class="c-section">
                                            <section class="c-section">
                                                <div class="c-section__title" id="tab1_ExpectedReturnTitle"></div>
                                                <div class="c-section__content">
                                                    <div class="c-chartBox">
                                                        <div id="chartsRevenue-01"></div>
                                                    </div>
                                                </div>
                                            </section>
                                        </div>
                                    </div>
                                    <div class="l-calcCharts__item l-calcCharts__item--2of3">
                                        <div class="c-section">
                                            <section class="c-section">
                                                <div class="c-section__title">投資報酬模擬</div>
                                                <div class="c-section__content">
                                                    <div class="c-chartBox">
                                                        <div id="chartsReward-01"></div>
                                                    </div>
                                                </div>
                                            </section>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            @if (!string.IsNullOrEmpty(Model.ExpectedReturnRemarks))
                            {
                                <div class="l-revenueResult__notes">
                                    @Model.ExpectedReturnRemarks
                                </div>
                            }

                            @if (isLogin)
                            {
                                <div class="l-revenueResult__actions">
                                    <a href="#" class="o-btn o-btn--primary o-btn--lg" data-save="true">儲存試算結果</a>
                                </div>
                            }
                        </div>
                    </div>
                </div>

                <!-- 遮罩 -->
                <section class="c-section Locker"></section>

                <!-- 風險屬性 & 資產配置 -->
                <div class="c-section" id="tab1RiskAsset">
                    <div class="c-section">
                        <div class="l-calcCharts">
                            <div class="l-calcCharts__item">
                                <!-- 風險屬性 -->
                                <section class="c-section">
                                    <div class="c-section__title">我的風險屬性</div>
                                    <div class="c-section__content">
                                        <div class="c-chartBox c-chartBox--sm@dt-only">
                                            <div class="l-riskCard">
                                                <div class="l-riskCard__charts">
                                                    <img src="~/themes/images/charts/rr4.svg" alt="">
                                                </div>
                                                <div class="l-riskCard__content">
                                                    <div class="l-riskCard__desc">已自動帶入您的風險屬性，如果想要變更請自行前往變更！如您已變更完成，請重新更新頁面</div>
                                                    <div class="l-riskCard__actions">
                                                        <a href="@WebKycLink" target="_blank" class="o-btn o-btn--secondary o-btn--thin o-btn--auto GoKYC">進行風險屬性評估</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </section>
                            </div>
                            <div class="l-calcCharts__item">
                                <!-- 資產配置 -->
                                <section class="c-section">
                                    <div class="c-section__title">資產配置</div>
                                    <div class="c-section__content">
                                        <div class="c-chartBox c-chartBox--sm@dt-only">
                                            <div id="chartsAssets-01" class="o-pie"></div>
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </div>
                    </div>

                    @if (!string.IsNullOrEmpty(Model.Notice))
                    {
                        <div class="c-section">
                            <div class="c-warning warningNotice">@Model.Notice</div>
                        </div>
                    }

                </div>

                <!-- 推薦基金 -->
                <div class="c-section" id="tab1Fund">
                    <div class="c-section__title">推薦基金</div>
                    <p class="tab1FundTip"></p>
                    <div class="c-section__content">
                        <div class="swiper c-swiper c-swiper--3rows recommendedFunds">
                            <div class="swiper-wrapper c-swiper__wrapper">

                            </div>
                            <div class="swiper-button-next c-swiper__next"></div>
                            <div class="swiper-button-prev c-swiper__prev"></div>
                            <div class="swiper-pagination c-swiper__pagination"></div>
                        </div>
                    </div>
                </div>

                <!-- 推薦ETF -->
                <div class="c-section" id="tab1ETF">
                    <div class="c-section__title">推薦ETF</div>
                    <div class="c-section__content">
                        <div class="swiper c-swiper c-swiper--minor recommendedETF">
                            <div class="swiper-wrapper c-swiper__wrapper">

                            </div>
                            <div class="swiper-button-next c-swiper__next"></div>
                            <div class="swiper-button-prev c-swiper__prev"></div>
                            <div class="swiper-pagination c-swiper__pagination"></div>
                        </div>
                    </div>
                </div>

                <!-- 推薦國外股票 -->
                <div class="c-section  u-hidden">
                    <div class="c-section__title">推薦國外股票</div>
                    <div class="c-section__content">
                        <div class="swiper c-swiper c-swiper--minor recommendedStock">
                            <div class="swiper-wrapper c-swiper__wrapper">

                            </div>
                            <div class="swiper-button-next c-swiper__next"></div>
                            <div class="swiper-button-prev c-swiper__prev"></div>
                            <div class="swiper-pagination c-swiper__pagination"></div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="c-tab__panel" data-tab-panel-id="tab-2">
                <div class="c-section" id="tab2_earningsChart">
                    <div class="c-section">
                        <div class="c-section__title u-hidden earningsChartTitle">推薦方案1</div>
                        <div class="c-section__content">
                            <div class="l-calcCard">
                                <div class="l-calcCard__head t-bold">
                                    <span class="t3">預期總收益</span>
                                    <span class="t1 t-warning" id="tab2_Total"></span>
                                </div>
                                <div class="l-calcCard__content">
                                    <div class="l-pipeList">
                                        <div class="l-pipeList__content">
                                            <ul class="c-pipeList s3 t-bold">
                                                <li class="c-pipeList__item ">
                                                    <span>法定退休金</span>
                                                    <span class="" id="tab2_Pension"></span>
                                                </li>
                                                <li class="c-pipeList__item t-push">
                                                    <span>每月投入</span>
                                                    <span class="t2" id="tab2_MonthlyInvestment"></span>
                                                </li>
                                                <li class="c-pipeList__item ">
                                                    <span>投資報酬率</span>
                                                    <span class="" id="tab2_ExpectedRoi"></span>
                                                </li>
                                                <li class="c-pipeList__item ">
                                                    <span>距離離退休還有</span>
                                                    <span class="" id="tab2_Years"></span>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="l-pipeList__actions">
                                            <a href="#popupAdjustment" class="o-btn o-btn--primary o-btn--sm o-btn--flat" data-popup="true">調整我的規劃</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="l-calcCard__desc">此推薦方案建議 增加每月投入金額，您可以嘗試調整多個項目來達成目標。</div>
                            </div>
                        </div>
                    </div>
                    <!-- 預期收益 & 投資報酬模擬 -->
                    <div class="c-section">
                        <div class="l-revenueResult">
                            <div class="l-revenueResult__charts">
                                <div class="l-calcCharts">
                                    <div class="l-calcCharts__item l-calcCharts__item--1of3">
                                        <div class="c-section">
                                            <section class="c-section">
                                                <div class="c-section__title" id="tab2_ExpectedReturnTitle"></div>
                                                <div class="c-section__content">
                                                    <div class="c-chartBox">
                                                        <div id="chartsRevenue-02"></div>
                                                    </div>
                                                </div>
                                            </section>
                                        </div>
                                    </div>
                                    <div class="l-calcCharts__item l-calcCharts__item--2of3">
                                        <div class="c-section">
                                            <section class="c-section">
                                                <div class="c-section__title">投資報酬模擬</div>
                                                <div class="c-section__content">
                                                    <div class="c-chartBox">
                                                        <div id="chartsReward-02"></div>
                                                    </div>
                                                </div>
                                            </section>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            @if (!string.IsNullOrEmpty(Model.ExpectedReturnRemarks))
                            {
                                <div class="l-revenueResult__notes">
                                    @Model.ExpectedReturnRemarks
                                </div>
                            }

                            @if (isLogin)
                            {
                                <div class="l-revenueResult__actions">
                                    <a href="#" class="o-btn o-btn--primary o-btn--lg" data-save="true">儲存試算結果</a>
                                </div>
                            }
                        </div>
                    </div>
                </div>

                <!-- 遮罩 -->
                <section class="c-section Locker"></section>

                <!-- 風險屬性 & 資產配置 -->
                <div class="c-section" id="tab2RiskAsset">
                    <div class="c-section">
                        <div class="l-calcCharts">
                            <div class="l-calcCharts__item">
                                <!-- 風險屬性 -->
                                <section class="c-section">
                                    <div class="c-section__title">我的風險屬性</div>
                                    <div class="c-section__content">
                                        <div class="c-chartBox c-chartBox--sm@dt-only">
                                            <div class="l-riskCard">
                                                <div class="l-riskCard__charts">
                                                    <img src="~/themes/images/charts/rr4.svg" alt="">
                                                </div>
                                                <div class="l-riskCard__content">
                                                    <div class="l-riskCard__desc">已自動帶入您的風險屬性，如果想要變更請自行前往變更！如您已變更完成，請重新更新頁面</div>
                                                    <div class="l-riskCard__actions">
                                                        <a href="@WebKycLink" target="_blank" class="o-btn o-btn--secondary o-btn--thin o-btn--auto GoKYC">進行風險屬性評估</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </section>
                            </div>
                            <div class="l-calcCharts__item">
                                <!-- 資產配置 -->
                                <section class="c-section">
                                    <div class="c-section__title">資產配置</div>
                                    <div class="c-section__content">
                                        <div class="c-chartBox c-chartBox--sm@dt-only">
                                            <div id="chartsAssets-02" class="o-pie"></div>
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </div>
                    </div>

                    @if (!string.IsNullOrEmpty(Model.Notice))
                    {
                        <div class="c-section">
                            <div class="c-warning warningNotice">@Model.Notice</div>
                        </div>
                    }

                </div>

                <!-- 推薦基金 -->
                <div class="c-section" id="tab2Fund">
                    <div class="c-section__title">推薦基金</div>
                    <p class="tab2FundTip"></p>
                    <div class="c-section__content">
                        <div class="swiper c-swiper c-swiper--3rows recommendedFunds">
                            <div class="swiper-wrapper c-swiper__wrapper">

                            </div>
                            <div class="swiper-button-next c-swiper__next"></div>
                            <div class="swiper-button-prev c-swiper__prev"></div>
                            <div class="swiper-pagination c-swiper__pagination"></div>
                        </div>
                    </div>
                </div>

                <!-- 推薦ETF -->
                <div class="c-section" id="tab2ETF">
                    <div class="c-section__title">推薦ETF</div>
                    <div class="c-section__content">
                        <div class="swiper c-swiper c-swiper--minor recommendedETF">
                            <div class="swiper-wrapper c-swiper__wrapper">

                            </div>
                            <div class="swiper-button-next c-swiper__next"></div>
                            <div class="swiper-button-prev c-swiper__prev"></div>
                            <div class="swiper-pagination c-swiper__pagination"></div>
                        </div>
                    </div>
                </div>

                <!-- 推薦國外股票 -->
                <div class="c-section  u-hidden">
                    <div class="c-section__title">推薦國外股票</div>
                    <div class="c-section__content">
                        <div class="swiper c-swiper c-swiper--minor recommendedStock">
                            <div class="swiper-wrapper c-swiper__wrapper">

                            </div>
                            <div class="swiper-button-next c-swiper__next"></div>
                            <div class="swiper-button-prev c-swiper__prev"></div>
                            <div class="swiper-pagination c-swiper__pagination"></div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="c-tab__panel" data-tab-panel-id="tab-3">
                <div class="c-section" id="tab3_earningsChart">
                    <div class="c-section">
                        <div class="c-section__title u-hidden earningsChartTitle">推薦方案2</div>
                        <div class="c-section__content">
                            <div class="l-calcCard">
                                <div class="l-calcCard__head t-bold">
                                    <span class="t3">預期總收益</span>
                                    <span class="t1 t-warning" id="tab3_Total"></span>
                                </div>
                                <div class="l-calcCard__content">
                                    <div class="l-pipeList">
                                        <div class="l-pipeList__content">
                                            <ul class="c-pipeList s3 t-bold">
                                                <li class="c-pipeList__item ">
                                                    <span>法定退休金</span>
                                                    <span class="" id="tab3_Pension"></span>
                                                </li>
                                                <li class="c-pipeList__item">
                                                    <span>每月投入</span>
                                                    <span class="" id="tab3_MonthlyInvestment"></span>
                                                </li>
                                                <li class="c-pipeList__item t-push">
                                                    <span>投資報酬率</span>
                                                    <span class="t2" id="tab3_ExpectedRoi"></span>
                                                </li>
                                                <li class="c-pipeList__item ">
                                                    <span>距離離退休還有</span>
                                                    <span class="" id="tab3_Years"></span>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="l-pipeList__actions">
                                            <a href="#popupAdjustment" class="o-btn o-btn--primary o-btn--sm o-btn--flat" data-popup="true">調整我的規劃</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="l-calcCard__desc">此推薦方案只有提升投資報酬率，您可以嘗試調整多個項目來達成目標。</div>
                            </div>
                        </div>
                    </div>
                    <!-- 預期收益 & 投資報酬模擬 -->
                    <div class="c-section">
                        <div class="l-revenueResult">
                            <div class="l-revenueResult__charts">
                                <div class="l-calcCharts">
                                    <div class="l-calcCharts__item l-calcCharts__item--1of3">
                                        <div class="c-section">
                                            <section class="c-section">
                                                <div class="c-section__title" id="tab3_ExpectedReturnTitle"></div>
                                                <div class="c-section__content">
                                                    <div class="c-chartBox">
                                                        <div id="chartsRevenue-03"></div>
                                                    </div>
                                                </div>
                                            </section>
                                        </div>
                                    </div>
                                    <div class="l-calcCharts__item l-calcCharts__item--2of3">
                                        <div class="c-section">
                                            <section class="c-section">
                                                <div class="c-section__title">投資報酬模擬</div>
                                                <div class="c-section__content">
                                                    <div class="c-chartBox">
                                                        <div id="chartsReward-03"></div>
                                                    </div>
                                                </div>
                                            </section>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            @if (!string.IsNullOrEmpty(Model.ExpectedReturnRemarks))
                            {
                                <div class="l-revenueResult__notes">
                                    @Model.ExpectedReturnRemarks
                                </div>
                            }

                            @if (isLogin)
                            {
                                <div class="l-revenueResult__actions">
                                    <a href="#" class="o-btn o-btn--primary o-btn--lg" data-save="true">儲存試算結果</a>
                                </div>
                            }
                        </div>
                    </div>
                </div>

                <!-- 遮罩 -->
                <section class="c-section Locker"></section>

                <!-- 風險屬性 & 資產配置 -->
                <div class="c-section" id="tab3RiskAsset">
                    <div class="c-section">
                        <div class="l-calcCharts">
                            <div class="l-calcCharts__item">
                                <!-- 風險屬性 -->
                                <section class="c-section">
                                    <div class="c-section__title">我的風險屬性</div>
                                    <div class="c-section__content">
                                        <div class="c-chartBox c-chartBox--sm@dt-only">
                                            <div class="l-riskCard">
                                                <div class="l-riskCard__charts">
                                                    <img src="~/themes/images/charts/rr4.svg" alt="">
                                                </div>
                                                <div class="l-riskCard__content">
                                                    <div class="l-riskCard__desc">已自動帶入您的風險屬性，如果想要變更請自行前往變更！如您已變更完成，請重新更新頁面</div>
                                                    <div class="l-riskCard__actions">
                                                        <a href="@WebKycLink" target="_blank" class="o-btn o-btn--secondary o-btn--thin o-btn--auto GoKYC">進行風險屬性評估</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </section>
                            </div>
                            <div class="l-calcCharts__item">
                                <!-- 資產配置 -->
                                <section class="c-section">
                                    <div class="c-section__title">資產配置</div>
                                    <div class="c-section__content">
                                        <div class="c-chartBox c-chartBox--sm@dt-only">
                                            <div id="chartsAssets-03" class="o-pie"></div>
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </div>
                    </div>

                    @if (!string.IsNullOrEmpty(Model.Notice))
                    {
                        <div class="c-section">
                            <div class="c-warning warningNotice">@Model.Notice</div>
                        </div>
                    }

                </div>

                <!-- 推薦基金 -->
                <div class="c-section" id="tab3Fund">
                    <div class="c-section__title">推薦基金</div>
                    <p class="tab3FundTip"></p>
                    <div class="c-section__content">
                        <div class="swiper c-swiper c-swiper--3rows recommendedFunds">
                            <div class="swiper-wrapper c-swiper__wrapper">

                            </div>
                            <div class="swiper-button-next c-swiper__next"></div>
                            <div class="swiper-button-prev c-swiper__prev"></div>
                            <div class="swiper-pagination c-swiper__pagination"></div>
                        </div>
                    </div>
                </div>

                <!-- 推薦ETF -->
                <div class="c-section" id="tab3ETF">
                    <div class="c-section__title">推薦ETF</div>
                    <div class="c-section__content">
                        <div class="swiper c-swiper c-swiper--minor recommendedETF">
                            <div class="swiper-wrapper c-swiper__wrapper">

                            </div>
                            <div class="swiper-button-next c-swiper__next"></div>
                            <div class="swiper-button-prev c-swiper__prev"></div>
                            <div class="swiper-pagination c-swiper__pagination"></div>
                        </div>
                    </div>
                </div>

                <!-- 推薦國外股票 -->
                <div class="c-section  u-hidden">
                    <div class="c-section__title">推薦國外股票</div>
                    <div class="c-section__content">
                        <div class="swiper c-swiper c-swiper--minor recommendedStock">
                            <div class="swiper-wrapper c-swiper__wrapper">

                            </div>
                            <div class="swiper-button-next c-swiper__next"></div>
                            <div class="swiper-button-prev c-swiper__prev"></div>
                            <div class="swiper-pagination c-swiper__pagination"></div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="c-tab__panel" data-tab-panel-id="tab-4">
                <div class="c-section" id="tab4_earningsChart">
                    <div class="c-section">
                        <div class="c-section__title u-hidden earningsChartTitle">推薦方案1</div>
                        <div class="c-section__content">
                            <div class="l-calcCard">
                                <div class="l-calcCard__head t-bold">
                                    <span class="t3">預期總收益</span>
                                    <span class="t1 t-warning" id="tab4_Total"></span>
                                </div>
                                <div class="l-calcCard__content">
                                    <div class="l-pipeList">
                                        <div class="l-pipeList__content">
                                            <ul class="c-pipeList s3 t-bold">
                                                <li class="c-pipeList__item ">
                                                    <span>法定退休金</span>
                                                    <span class="" id="tab4_Pension"></span>
                                                </li>
                                                <li class="c-pipeList__item">
                                                    <span>每月投入</span>
                                                    <span class="" id="tab4_MonthlyInvestment"></span>
                                                </li>
                                                <li class="c-pipeList__item t-push">
                                                    <span>投資報酬率</span>
                                                    <span class="t2" id="tab4_ExpectedRoi"></span>
                                                </li>
                                                <li class="c-pipeList__item ">
                                                    <span>距離離退休還有</span>
                                                    <span class="" id="tab4_Years"></span>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="l-pipeList__actions">
                                            <a href="#popupAdjustment" class="o-btn o-btn--primary o-btn--sm o-btn--flat" data-popup="true">調整我的規劃</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="l-calcCard__desc">此推薦方案建議 增加每月投入金額，您可以嘗試調整多個項目來達成目標。</div>
                            </div>
                        </div>
                    </div>
                    <!-- 預期收益 & 投資報酬模擬 -->
                    <div class="c-section">
                        <div class="l-revenueResult">
                            <div class="l-revenueResult__charts">
                                <div class="l-calcCharts">
                                    <div class="l-calcCharts__item l-calcCharts__item--1of3">
                                        <div class="c-section">
                                            <section class="c-section">
                                                <div class="c-section__title" id="tab4_ExpectedReturnTitle"></div>
                                                <div class="c-section__content">
                                                    <div class="c-chartBox">
                                                        <div id="chartsRevenue-04"></div>
                                                    </div>
                                                </div>
                                            </section>
                                        </div>
                                    </div>
                                    <div class="l-calcCharts__item l-calcCharts__item--2of3">
                                        <div class="c-section">
                                            <section class="c-section">
                                                <div class="c-section__title">投資報酬模擬</div>
                                                <div class="c-section__content">
                                                    <div class="c-chartBox">
                                                        <div id="chartsReward-04"></div>
                                                    </div>
                                                </div>
                                            </section>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            @if (!string.IsNullOrEmpty(Model.ExpectedReturnRemarks))
                            {
                                <div class="l-revenueResult__notes">
                                    @Model.ExpectedReturnRemarks
                                </div>
                            }

                            @if (isLogin)
                            {
                                <div class="l-revenueResult__actions">
                                    <a href="#" class="o-btn o-btn--primary o-btn--lg" data-save="true">儲存試算結果</a>
                                </div>
                            }
                        </div>
                    </div>
                </div>

                <!-- 遮罩 -->
                <section class="c-section Locker"></section>

                <!-- 風險屬性 & 資產配置 -->
                <div class="c-section" id="tab4RiskAsset">
                    <div class="c-section">
                        <div class="l-calcCharts">
                            <div class="l-calcCharts__item">
                                <!-- 風險屬性 -->
                                <section class="c-section">
                                    <div class="c-section__title">我的風險屬性</div>
                                    <div class="c-section__content">
                                        <div class="c-chartBox c-chartBox--sm@dt-only">
                                            <div class="l-riskCard">
                                                <div class="l-riskCard__charts">
                                                    <img src="~/themes/images/charts/rr4.svg" alt="">
                                                </div>
                                                <div class="l-riskCard__content">
                                                    <div class="l-riskCard__desc">已自動帶入您的風險屬性，如果想要變更請自行前往變更！如您已變更完成，請重新更新頁面</div>
                                                    <div class="l-riskCard__actions">
                                                        <a href="@WebKycLink" target="_blank" class="o-btn o-btn--secondary o-btn--thin o-btn--auto GoKYC">進行風險屬性評估</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </section>
                            </div>
                            <div class="l-calcCharts__item">
                                <!-- 資產配置 -->
                                <section class="c-section">
                                    <div class="c-section__title">資產配置</div>
                                    <div class="c-section__content">
                                        <div class="c-chartBox c-chartBox--sm@dt-only">
                                            <div id="chartsAssets-04" class="o-pie"></div>
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </div>
                    </div>

                    @if (!string.IsNullOrEmpty(Model.Notice))
                    {
                        <div class="c-section">
                            <div class="c-warning warningNotice">@Model.Notice</div>
                        </div>
                    }

                </div>

                <!-- 推薦基金 -->
                <div class="c-section" id="tab4Fund">
                    <div class="c-section__title">推薦基金</div>
                    <p class="tab4FundTip"></p>
                    <div class="c-section__content">
                        <div class="swiper c-swiper c-swiper--3rows recommendedFunds">
                            <div class="swiper-wrapper c-swiper__wrapper">

                            </div>
                            <div class="swiper-button-next c-swiper__next"></div>
                            <div class="swiper-button-prev c-swiper__prev"></div>
                            <div class="swiper-pagination c-swiper__pagination"></div>
                        </div>
                    </div>
                </div>

                <!-- 推薦ETF -->
                <div class="c-section" id="tab4ETF">
                    <div class="c-section__title">推薦ETF</div>
                    <div class="c-section__content">
                        <div class="swiper c-swiper c-swiper--minor recommendedETF">
                            <div class="swiper-wrapper c-swiper__wrapper">

                            </div>
                            <div class="swiper-button-next c-swiper__next"></div>
                            <div class="swiper-button-prev c-swiper__prev"></div>
                            <div class="swiper-pagination c-swiper__pagination"></div>
                        </div>
                    </div>
                </div>

                <!-- 推薦國外股票 -->
                <div class="c-section  u-hidden">
                    <div class="c-section__title">推薦國外股票</div>
                    <div class="c-section__content">
                        <div class="swiper c-swiper c-swiper--minor recommendedStock">
                            <div class="swiper-wrapper c-swiper__wrapper">

                            </div>
                            <div class="swiper-button-next c-swiper__next"></div>
                            <div class="swiper-button-prev c-swiper__prev"></div>
                            <div class="swiper-pagination c-swiper__pagination"></div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</section>

<!-- 遠距諮詢有登入 -->
<section id="consultsuccess" class="c-section  u-hidden">
    <div class="l-wrap">
        <div class="c-section__content">
            <div class="l-feature l-feature--sm">
                <ul class="l-feature__list">
                    <li class="l-feature__item">
                        <div class="c-feature c-feature--join c-feature--personalize">
                            <div class="c-feature__content u-center">

                                @if (!string.IsNullOrEmpty(Model.RemoteConsultationSuccessTitle))
                                {
                                    <h3 class="c-feature__title">@Model.RemoteConsultationSuccessTitle</h3>
                                }

                                @if (!string.IsNullOrEmpty(Model.RemoteConsultationSuccessContent))
                                {
                                    <p class="c-feature__desc">@Model.RemoteConsultationSuccessContent</p>
                                }

                                @if (!string.IsNullOrEmpty(Model.RemoteConsultationSuccessButtonText) || !string.IsNullOrEmpty(Model.RemoteConsultationSuccessButtonLink))
                                {
                                    <div class="c-feature__actions">
                                        @Html.Sitecore().BeginField(Template.Calculate.Fields.RemoteConsultationSuccessButtonLink.ToString(), Model.Datasource, new { haschildren = true, @class = "o-btn o-btn--primary o-btn--flat o-btn--sm" })
                                        @Html.Sitecore().Field(Template.Calculate.Fields.RemoteConsultationSuccessButtonText.ToString(), Model.Datasource)
                                        @Html.Sitecore().EndField()
                                    </div>
                                }
                            </div>

                            @if (!string.IsNullOrEmpty(Model.RemoteConsultationSuccessImage))
                            {
                                <div class="c-feature__plate">
                                    <img src="@Model.RemoteConsultationSuccessImage" srcset="" alt="遠距諮詢 解決您的理財大小事" class="c-feature__img">
                                </div>
                            }

                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</section>

<!-- 遠距諮詢未登入 -->
<section id="consultsuccessful" class="c-section  u-hidden">
    <div class="l-wrap">
        <div class="c-section__content">
            <div class="l-feature l-feature--sm">
                <ul class="l-feature__list">
                    <li class="l-feature__item">
                        <div class="c-feature c-feature--join c-feature--personalize">
                            <div class="c-feature__content u-center">

                                @if (!string.IsNullOrEmpty(Model.RemoteConsultationSuccessfulTitle))
                                {
                                    <h3 class="c-feature__title">@Model.RemoteConsultationSuccessfulTitle</h3>
                                }

                                @if (!string.IsNullOrEmpty(Model.RemoteConsultationSuccessfulContent))
                                {
                                    <p class="c-feature__desc">@Model.RemoteConsultationSuccessfulContent</p>
                                }

                                @if (!string.IsNullOrEmpty(Model.RemoteConsultationSuccessfulButtonText) || !string.IsNullOrEmpty(Model.RemoteConsultationSuccessfulButtonLink))
                                {
                                    <div class="c-feature__actions">
                                        @Html.Sitecore().BeginField(Template.Calculate.Fields.RemoteConsultationSuccessfulButtonLink.ToString(), Model.Datasource, new { haschildren = true, @class = "o-btn o-btn--primary o-btn--flat o-btn--sm" })
                                        @Html.Sitecore().Field(Template.Calculate.Fields.RemoteConsultationSuccessfulButtonText.ToString(), Model.Datasource)
                                        @Html.Sitecore().EndField()
                                    </div>
                                }
                            </div>

                            @if (!string.IsNullOrEmpty(Model.RemoteConsultationSuccessfulImage))
                            {
                                <div class="c-feature__plate">
                                    <img src="@Model.RemoteConsultationSuccessfulImage" srcset="" alt="遠距諮詢 解決您的理財大小事" class="c-feature__img">
                                </div>
                            }

                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</section>

<!-- 解鎖專屬推薦彈窗 -->
<div id="popupRisk" class="c-modal c-modal--sm mfp-hide">
    <div class="c-modal__wrap">
        <header class="c-modal__header">
            <h2 class="c-modal__title">獲得專屬推薦</h2>
        </header>
        <div class="c-modal__content">
            <div class="c-calcLocker">
                <div class="l-wrap">
                    <div class="c-calcLocker__icon">
                        <img src="~/themes/images/icons/others/lock.svg" alt="">
                    </div>
                    <div class="c-calcLocker__desc ">如已完成風險屬性評估，可立即解鎖專屬推薦！</div>
                    <div class="c-calcLocker__actions">
                        <div class="c-calcLocker__btn">
                            <!-- #btnUnlock: 展示另開彈跳視窗用，開發時可參考下方 script 自行調整 -->
                            <a id="btnUnlock" href="#" class="o-btn o-btn--primary o-btn--lg">解鎖專屬推薦</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 成功解鎖專屬推薦彈窗 -->
<div id="popupRisksuccess" class="c-modal c-modal--sm mfp-hide">
    <div class="c-modal__wrap">
        <header class="c-modal__header">
            <h2 class="c-modal__title">獲得專屬推薦</h2>
        </header>
        <div class="c-modal__content">
            <div class="c-calcLocker">
                <div class="l-wrap">
                    <div class="c-calcLocker__icon">
                        <img src="~/themes/images/icons/others/unlock.svg" alt="">
                    </div>
                    <div class="c-calcLocker__desc ">我已完成風險屬性評估！立即解鎖專屬推薦</div>
                    <div class="c-calcLocker__actions">
                        <div class="c-calcLocker__btn">
                            <a id="btnUnlocksuccess" href="#" class="o-btn o-btn--primary o-btn--lg">解鎖專屬推薦</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 尚未進行風險屬性評估彈窗 -->
<div id="popupRiskInvalid" class="c-modal c-modal--sm mfp-hide">
    <div class="c-modal__wrap">
        <header class="c-modal__header">
            <h2 class="c-modal__title">尚未進行風險屬性評估</h2>
        </header>
        <div class="c-modal__content">
            <div class="c-calcLocker">
                <div class="l-wrap">
                    <div class="c-calcLocker__icon">
                        <img src="~/themes/images/icons/others/attention.svg" alt="">
                    </div>
                    <div class="c-calcLocker__desc ">您尚未完成風險評估，可至網銀進行風險屬性評估</div>
                    <div class="c-calcLocker__actions">
                        <div class="c-calcLocker__btn">
                            <button type="button" id="GOKYC1" class="o-btn o-btn--primary o-btn--lg">風險屬性評估</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    (function ($, window, document, undefined) {
        document.addEventListener("DOMContentLoaded", function () {
            var resultHasGap;
            var description, readingbar = [], earningsChart = [], chartsRevenues = [], chartsRewards = [], chartsRewardsCategories = [], chartsAssets = [];
            var hasRenderedRecommendations = false;
            var lockImg = "/themes/images/icons/others/lock.svg"
            var defaultRiskAttributes = '@Model.DefaultRiskAttributes';
            var fundIds = @(new HtmlString(JsonHelper.SerializeObject(Model.FundID)));
            var yearBegin, yearEnd, lifeExpectancy, currentMonthlyCost, retireMonthlyCost, amountPrepared, pension, monthlyInvestment, expectedRoi, payExpensesYears;
            var RetyearBegin, RetyearEnd, RetlifeExpectancy, RetcurrentMonthlyCost, RetretireMonthlyCost, RetamountPrepared, Retpension, RetmonthlyInvestment, RetexpectedRoi, RetpayExpensesYears;
            var SessionKeys = [
                'RetyearBegin',
                'RetyearEnd',
                'RetlifeExpectancy',
                'RetcurrentMonthlyCost',
                'RetretireMonthlyCost',
                'RetamountPrepared',
                'Retpension',
                'RetmonthlyInvestment',
                'RetexpectedRoi',
                'RetpayExpensesYears'
            ];
            var assetsData = {
                stock: {
                    number: @Model.StockAllocation,
                    fieldName: '@Model.StockAllocationFieldName',
                    text: '@Model.StockAllocationText'
                },
                bond: {
                    number: @Model.BondAllocation,
                    fieldName: '@Model.BondAllocationFieldName',
                    text: '@Model.BondAllocationText'
                },
                currency: {
                    number: @Model.CurrencyAllocation,
                    fieldName: '@Model.CurrencyAllocationFieldName',
                    text: '@Model.CurrencyAllocationText'
                }
            };

            if (SC_DATA.IsLoggedIn) {

                if (SC_DATA.Gender == 1) {
                    $('#lifeExpectancy').attr("value", 76);
                    $('#lifeExpectancy').trigger("change");
                }

                $('[data-save="true"]').removeClass('u-hidden');

                if (SC_DATA.Risk == undefined) {
                    RiskHandler().then((data) => {
                        SC_DATA.Risk = data.risk;
                    });
                }

                if (SC_DATA.Risk !== undefined && SC_DATA.PlatForm == 'WebBank') {

                    UpdateRiskAttributesContent(SC_DATA.Risk);

                } else if (SC_DATA.Risk == undefined && SC_DATA.PlatForm == 'WebBank') {
                    renderNotRisk();
                }
            } else {
                renderNotLogin();
            }

            //#region 預計幾年後達成目標綁定事件
            let $sliderYear = $('[data-slider-id="year"]').get(0),
                $inputYearBegin = $('[data-id="yearBegin"]'),
                $inputYearEnd = $('[data-id="yearEnd"]');
            noUiSlider.create($sliderYear, {
                start: [40, 65],
                connect: true,
                setp: 1,
                margin: 1,
                range: {
                    'min': [20, 1],
                    'max': 85
                },
                format: wNumb({
                    decimals: 0
                }),
                pips: {
                    mode: 'positions',
                    values: [0, 100],
                    density: -1,
                    format: wNumb({
                        decimals: 0,
                        suffix: '歲'
                    })
                }
            });
            $sliderYear.noUiSlider.on('update', function (values, handle) {
                const year = Number(values[handle]);
                if (handle) {
                    $inputYearEnd.val(year);
                    inputCheck('yearEnd', year);
                } else {
                    $inputYearBegin.val(year);
                }
            });
            $inputYearBegin.on('change', function () {
                $sliderYear.noUiSlider.set([this.value, null]);
            });
            $inputYearEnd.on('change', function () {
                $sliderYear.noUiSlider.set([null, this.value]);
            });
            //#endregion

            //#region 預期投資報酬率綁定事件
            let $sliderRoi = $('[data-slider-id="roi"]').get(0),
                $inputRoi = $('[data-id="roi"]');
            noUiSlider.create($sliderRoi, {
                start: 2,
                connect: [true, false],
                setp: 0.01,
                range: {
                    'min': [1, 0.01],
                    'max': 50
                },
                format: wNumb({
                    decimals: 2
                }),
                pips: {
                    mode: 'positions',
                    values: [0, 100],
                    density: -1,
                    format: wNumb({
                        decimals: 0,
                        suffix: '％'
                    })
                }
            });
            $sliderRoi.noUiSlider.on('update', function (values, handle) {
                const year = values[handle];
                $inputRoi.val(year);
            });
            $inputRoi.on('change', function () {
                $sliderRoi.noUiSlider.set([this.value]);
            });
            //#endregion

            //#region 預計幾年後達成目標綁定事件(Popup)

            let $inputYearBeginPopup = $('[data-id="yearbegin_popup"]'),
                $inputYearEndPopup = $('[data-id="yearend_popup"]');

            $inputYearBeginPopup.on('change', function () {
                let value = parseInt(this.value, 10);

                if (isNaN(value)) {
                    value = 20;
                } else {
                    if (value < 20) {
                        value = 20;
                    } else if (value > 84) {
                        value = 84;
                    }
                }

                $(this).val(value);

                let endValue = parseInt($inputYearEndPopup.val(), 10);

                if (value >= endValue) {
                    endValue = value + 1;
                    if (endValue > 85) {
                        endValue = 85;
                    }

                    $inputYearEndPopup.val(endValue);
                }
            });

            $inputYearEndPopup.on('change', function () {
                let value = parseInt(this.value, 10);

                if (isNaN(value)) {
                    value = 85;
                } else {
                    let beginValue = parseInt($inputYearBeginPopup.val(), 10);

                    if (value < beginValue + 1) {
                        value = beginValue + 1;
                    } else if (value > 85) {
                        value = 85;
                    }
                }

                $(this).val(value);
            });

            //#endregion

            //#region 預期投資報酬率綁定事件(Popup)
            $('[data-id="popup_roi"]').on('change', function () {
                let value = parseFloat(this.value);

                if (isNaN(value)) {
                    value = 1;
                } else {
                    if (value < 1) {
                        value = 1;
                    } else if (value > 50) {
                        value = 50;
                    }

                    value = value.toFixed(2);
                }

                $(this).val(value);
            });
            //#endregion

            //#region 每月投入金額綁定事件
            let $inputMonthly = $('[data-id="monthly"]');
            let lastValidMonthly = parseFloat($inputMonthly.val()) || 1;

            $inputMonthly.on('change', function () {
                let monthly = parseFloat($(this).val());

                if (isNaN(monthly) || monthly < 1) {
                    monthly = 1;
                }

                let trimmedMonthly = trimZeroAndDot(monthly.toString());
                $(this).val(trimmedMonthly);
                lastValidMonthly = parseFloat(trimmedMonthly);
            });

            let $inputMonthly_popup = $('[data-id="popup_monthly"]');
            let lastValidMonthly_popup = parseFloat($inputMonthly_popup.val()) || 1;

            $inputMonthly_popup.on('change', function () {
                let monthly = parseFloat($(this).val());

                if (isNaN(monthly) || monthly < 1) {
                    monthly = 1;
                }

                let trimmedMonthly = trimZeroAndDot(monthly.toString());
                $(this).val(trimmedMonthly);
                lastValidMonthly_popup = parseFloat(trimmedMonthly);
            });
            //#endregion

            //#region 各欄位綁定事件
            $("#yearBegin, #yearEnd, #lifeExpectancy, #currentMonthlyCost, #retireMonthlyCost, #amountPrepared, #pension, #yearBegin_Popup, #yearEnd_Popup, #lifeExpectancy_Popup, #currentMonthlyCost_Popup, #retireMonthlyCost_Popup, #amountPrepared_Popup, #pension_Popup").on('change', function () {
                var id = this.id;
                var val = $(this).val();
                var formatVal = trimZeroAndDot(val);
                inputCheck(id, formatVal);
            });
            //#endregion

            //#region 如果有值就執行試算
            $(document).ready(function () {
                if (SessionStorageExist(SessionKeys)) {
                    RetyearBegin = Number(sessionStorage.getItem('RetyearBegin'));
                    RetyearEnd = Number(sessionStorage.getItem('RetyearEnd'));
                    RetlifeExpectancy = Number(sessionStorage.getItem('RetlifeExpectancy'));
                    RetcurrentMonthlyCost = Number(sessionStorage.getItem('RetcurrentMonthlyCost'));
                    RetretireMonthlyCost = Number(sessionStorage.getItem('RetretireMonthlyCost'));
                    RetamountPrepared = Number(sessionStorage.getItem('RetamountPrepared'));
                    Retpension = Number(sessionStorage.getItem('Retpension'));
                    RetmonthlyInvestment = Number(sessionStorage.getItem('RetmonthlyInvestment'));
                    RetexpectedRoi = Number(sessionStorage.getItem('RetexpectedRoi'));
                    RetpayExpensesYears = Number(sessionStorage.getItem('RetpayExpensesYears'));

                    $('#Calculate').trigger('click');
                    RemoveSessionVal();
                }
            });
            //#endregion

            //#region SessionVal狀態設定事件
            //設定Session
            function SetSessionVal(yearBegin, yearEnd, lifeExpectancy, currentMonthlyCost, retireMonthlyCost, amountPrepared, pension, monthlyInvestment, expectedRoi, payExpensesYears) {
                sessionStorage.setItem('RetyearBegin', yearBegin);
                sessionStorage.setItem('RetyearEnd', yearEnd);
                sessionStorage.setItem('RetlifeExpectancy', lifeExpectancy);
                sessionStorage.setItem('RetcurrentMonthlyCost', currentMonthlyCost);
                sessionStorage.setItem('RetretireMonthlyCost', retireMonthlyCost);
                sessionStorage.setItem('RetamountPrepared', amountPrepared);
                sessionStorage.setItem('Retpension', pension);
                sessionStorage.setItem('RetmonthlyInvestment', monthlyInvestment);
                sessionStorage.setItem('RetexpectedRoi', expectedRoi);
                sessionStorage.setItem('RetpayExpensesYears', payExpensesYears);
            }
            //移除Session
            function RemoveSessionVal() {
                yearBegin = RetyearBegin;
                yearEnd = RetyearEnd;
                lifeExpectancy = RetlifeExpectancy;
                currentMonthlyCost = RetcurrentMonthlyCost;
                retireMonthlyCost = RetretireMonthlyCost;
                amountPrepared = RetamountPrepared;
                pension = Retpension;
                monthlyInvestment = RetmonthlyInvestment;
                expectedRoi = RetexpectedRoi;
                payExpensesYears = parseFloat(lifeExpectancy) - parseFloat(yearEnd);

                sessionStorage.removeItem('RetyearBegin', yearBegin);
                sessionStorage.removeItem('RetyearEnd', yearEnd);
                sessionStorage.removeItem('RetlifeExpectancy', lifeExpectancy);
                sessionStorage.removeItem('RetcurrentMonthlyCost', currentMonthlyCost);
                sessionStorage.removeItem('RetretireMonthlyCost', retireMonthlyCost);
                sessionStorage.removeItem('RetamountPrepared', amountPrepared);
                sessionStorage.removeItem('Retpension', pension);
                sessionStorage.removeItem('RetmonthlyInvestment', monthlyInvestment);
                sessionStorage.removeItem('RetexpectedRoi', expectedRoi);
                sessionStorage.removeItem('RetpayExpensesYears', payExpensesYears);
            }
            //判斷Session是否有資料
            function SessionStorageExist(keys) {
                return keys.every(key => sessionStorage.getItem(key) !== null);
            }
            //#endregion

            //#region 開始試算按鈕綁定事件
            $("#Calculate").click(function () {
                if (clickCheck()) {
                    loading();

                    // 隱藏試算 HTML
                    $("#calculateDescription").addClass("u-hidden");
                    $("#calculateMain").addClass("u-hidden");
                    $('.l-mainstage').first().addClass('u-hidden');

                    yearBegin = $("#yearBegin").val();
                    yearEnd = $("#yearEnd").val();
                    lifeExpectancy = $("#lifeExpectancy").val();
                    currentMonthlyCost = $("#currentMonthlyCost").val();
                    retireMonthlyCost = $("#retireMonthlyCost").val();
                    amountPrepared = $("#amountPrepared").val();
                    pension = $("#pension").val();
                    monthlyInvestment = $("#monthlyInvestment").val();
                    expectedRoi = $("#expectedRoi").val();
                    payExpensesYears = parseFloat(lifeExpectancy) - parseFloat(yearEnd);

                    //Session設定或清空判斷
                    if (!SC_DATA.IsLoggedIn && SessionStorageExist(SessionKeys)) {
                        yearBegin = RetyearBegin;
                        yearEnd = RetyearEnd;
                        lifeExpectancy = RetlifeExpectancy;
                        currentMonthlyCost = RetcurrentMonthlyCost;
                        retireMonthlyCost = RetretireMonthlyCost;
                        amountPrepared = RetamountPrepared;
                        pension = Retpension;
                        monthlyInvestment = RetmonthlyInvestment;
                        expectedRoi = RetexpectedRoi;
                        payExpensesYears = parseFloat(lifeExpectancy) - parseFloat(yearEnd);
                    } else {
                        SetSessionVal(yearBegin, yearEnd, lifeExpectancy, currentMonthlyCost, retireMonthlyCost, amountPrepared, pension, monthlyInvestment, expectedRoi, payExpensesYears);
                    }

                    $("#yearBegin_Popup").val(yearBegin);
                    $("#yearEnd_Popup").val(yearEnd);
                    $("#lifeExpectancy_Popup").val(lifeExpectancy);
                    $("#currentMonthlyCost_Popup").val(currentMonthlyCost);
                    $("#retireMonthlyCost_Popup").val(retireMonthlyCost);
                    $("#amountPrepared_Popup").val(amountPrepared);
                    $("#pension_Popup").val(pension);
                    $("#monthlyInvestment_Popup").val(monthlyInvestment);
                    $("#expectedRoi_Popup").val(expectedRoi);
                    $("#payExpensesVal_Popup").text(payExpensesYears);

                    // 年期
                    let years = parseFloat(yearEnd) - parseFloat(yearBegin);

                    // 退休至臨終所需花費(目標金額)
                    let targetAmount = targetAmountCompute(lifeExpectancy, yearEnd, retireMonthlyCost);

                    // 期末總金額A (總收益：含法定退休金) 結果
                    let totalA = totalACompute(years, amountPrepared, monthlyInvestment, expectedRoi, pension);

                    // 期末總金額B (總收益-總花費) 結果
                    let totalB = totalA - targetAmount;

                    let tab1Results, tab2Results, tab3Results, tab4Results, currentYear;

                    // 圖表資料清除
                    clearChartDatas();

                    // 顯示試算結果 - 描述區塊
                    $("#resultDescription").removeClass("u-hidden");
                    renderResultDescription(yearBegin, yearEnd, amountPrepared, pension, years, targetAmount, totalA, totalB);

                    // 顯示試算結果 - tab區塊
                    $("#resultTab").removeClass("u-hidden");

                    // 判斷試算結果是否有缺口
                    if (!resultHasGap) {
                        $(".tab1Btn").removeClass("u-hidden");
                        $(".tab2Btn").addClass("u-hidden");
                        $(".tab3Btn").addClass("u-hidden");
                        $(".tab4Btn").removeClass("u-hidden");

                        if (SC_DATA.Risk == '1') {
                            defaultRiskAttributes = 2;
                        } else if (SC_DATA.Risk == '2') {
                            defaultRiskAttributes = 5;
                        } else if (SC_DATA.Risk == '3') {
                            defaultRiskAttributes = 7;
                        }

                        tab1Results = totalA;
                        tab4Results = totalACompute(years, amountPrepared, monthlyInvestment, (parseFloat(expectedRoi) + parseFloat(defaultRiskAttributes)).toString(), pension);

                        renderResultTab1(tab1Results, totalB, targetAmount, years, pension, amountPrepared, monthlyInvestment, expectedRoi);
                        renderResultTab4(tab4Results, targetAmount, years, amountPrepared, pension, monthlyInvestment, (parseFloat(expectedRoi) + parseFloat(defaultRiskAttributes)).toString());
                    }
                    else {
                        $(".tab1Btn").removeClass("u-hidden");
                        $(".tab2Btn").removeClass("u-hidden");
                        $(".tab3Btn").removeClass("u-hidden");
                        $(".tab4Btn").addClass("u-hidden");

                        tab1Results = totalA;
                        tab2Results = tab2Compute(years, totalB, expectedRoi, monthlyInvestment);
                        tab3Results = tab3Compute(years, monthlyInvestment, amountPrepared, targetAmount, pension);

                        renderResultTab1(tab1Results, totalB, targetAmount, years, pension, amountPrepared, monthlyInvestment, expectedRoi);
                        renderResultTab2(tab2Results, targetAmount, years, amountPrepared, pension, expectedRoi);
                        renderResultTab3(tab3Results, targetAmount, years, amountPrepared, pension, monthlyInvestment);
                    }

                    // 顯示預期收益圓餅圖
                    renderChartsRevenues(chartsRevenues);

                    // 取得長條圖年份顯示範圍
                    currentYear = new Date().getFullYear() + years - 1;
                    getRewardsYearsRange(currentYear);

                    // 顯示投資報酬長條圖
                    renderChartsRewards(chartsRewards);

                    // 顯示資產配置圓餅圖
                    renderChartsAssets(chartsAssets);

                    // 顯示試算結果 - 諮詢區塊
                    if (SC_DATA.IsLoggedIn && SC_DATA.WebBankId !== "") {
                        $("#consultsuccess").removeClass("u-hidden");
                    }
                    else {
                        $("#consultsuccessful").removeClass("u-hidden");
                    }
                }
            });
            //#endregion

            //#region 重新試算按鈕綁定事件
            $("#Recalculate").click(function () {
                if (clickCheck()) {
                    loading();

                    $.magnificPopup.close();
                    $('.l-mainstage').first().addClass('u-hidden');

                    yearBegin = $("#yearBegin_Popup").val();
                    yearEnd = $("#yearEnd_Popup").val();
                    lifeExpectancy = $("#lifeExpectancy_Popup").val();
                    currentMonthlyCost = $("#currentMonthlyCost_Popup").val();
                    retireMonthlyCost = $("#retireMonthlyCost_Popup").val();
                    amountPrepared = $("#amountPrepared_Popup").val();
                    pension = $("#pension_Popup").val();
                    monthlyInvestment = $("#monthlyInvestment_Popup").val();
                    expectedRoi = $("#expectedRoi_Popup").val();
                    payExpensesYears = parseFloat(lifeExpectancy) - parseFloat(yearEnd);

                    //設定Session
                    SetSessionVal(yearBegin, yearEnd, lifeExpectancy, currentMonthlyCost, retireMonthlyCost, amountPrepared, pension, monthlyInvestment, expectedRoi, payExpensesYears);

                    // 年期
                    let years = parseFloat(yearEnd) - parseFloat(yearBegin);

                    // 退休至臨終所需花費(目標金額)
                    let targetAmount = targetAmountCompute(lifeExpectancy, yearEnd, retireMonthlyCost);

                    // 期末總金額A (總收益：含法定退休金) 結果
                    let totalA = totalACompute(years, amountPrepared, monthlyInvestment, expectedRoi, pension);

                    // 期末總金額B (總收益-總花費) 結果
                    let totalB = totalA - targetAmount;

                    let tab1Results, tab2Results, tab3Results, tab4Results, currentYear;

                    // 圖表資料清除
                    clearChartDatas();

                    // 顯示試算結果 - 描述區塊
                    $("#resultDescription").removeClass("u-hidden");
                    renderResultDescription(yearBegin, yearEnd, amountPrepared, pension, years, targetAmount, totalA, totalB);

                    // 顯示試算結果 - tab區塊
                    $("#resultTab").removeClass("u-hidden");

                    // 判斷試算結果是否有缺口
                    if (!resultHasGap) {
                        $(".tab1Btn").removeClass("u-hidden");
                        $(".tab2Btn").addClass("u-hidden");
                        $(".tab3Btn").addClass("u-hidden");
                        $(".tab4Btn").removeClass("u-hidden");

                        tab1Results = totalA;
                        tab4Results = totalACompute(years, amountPrepared, monthlyInvestment, (parseFloat(expectedRoi) + parseFloat(defaultRiskAttributes)).toString(), pension);

                        renderResultTab1(tab1Results, totalB, targetAmount, years, pension, amountPrepared, monthlyInvestment, expectedRoi);
                        renderResultTab4(tab4Results, targetAmount, years, amountPrepared, pension, monthlyInvestment, (parseFloat(expectedRoi) + parseFloat(defaultRiskAttributes)).toString());
                    }
                    else {
                        $(".tab1Btn").removeClass("u-hidden");
                        $(".tab2Btn").removeClass("u-hidden");
                        $(".tab3Btn").removeClass("u-hidden");
                        $(".tab4Btn").addClass("u-hidden");

                        tab1Results = totalA;
                        tab2Results = tab2Compute(years, totalB, expectedRoi, monthlyInvestment);
                        tab3Results = tab3Compute(years, monthlyInvestment, amountPrepared, targetAmount, pension);

                        renderResultTab1(tab1Results, totalB, targetAmount, years, pension, amountPrepared, monthlyInvestment, expectedRoi);
                        renderResultTab2(tab2Results, targetAmount, years, amountPrepared, pension, expectedRoi);
                        renderResultTab3(tab3Results, targetAmount, years, amountPrepared, pension, monthlyInvestment);
                    }

                    // tab active 狀態復原
                    bindTabSwitchEvent();

                    // 顯示預期收益圓餅圖
                    renderChartsRevenues(chartsRevenues);

                    // 取得長條圖年份顯示範圍
                    currentYear = new Date().getFullYear() + years - 1;
                    getRewardsYearsRange(currentYear);

                    // 顯示投資報酬長條圖
                    renderChartsRewards(chartsRewards);

                    // 顯示資產配置圓餅圖
                    renderChartsAssets(chartsAssets);

                    // 顯示試算結果 - 諮詢區塊
                    if (SC_DATA.IsLoggedIn && SC_DATA.WebBankId !== "") {
                        $("#consultsuccess").removeClass("u-hidden");
                    }
                    else {
                        $("#consultsuccessful").removeClass("u-hidden");
                    }
                }
            });
            //#endregion

            //#region 綁定TabSwitch事件
            function bindTabSwitchEvent() {
                $("ul.c-tab__navs a:first").off("click.myEvent").on("click.myEvent", function (event) {
                    event.preventDefault();

                    $(".tab1Btn").addClass("is-active");
                    $(".tab2Btn,.tab3Btn,.tab4Btn").removeClass("is-active");

                    $('[data-tab-panel-id="tab-1"]').addClass("is-active");
                    $('[data-tab-panel-id="tab-2"],[data-tab-panel-id="tab-3"],[data-tab-panel-id="tab-4"]').removeClass("is-active");

                    (function (s, i) {
                        "use strict";
                        var n = "tab",
                            o = {
                                docking: !0,
                                scroll: !0
                            };

                        function a(t, e) {
                            this.element = t,
                                this.$element = s(t),
                                this.options = s.extend(!0, {}, o, e, this.$element.data()),
                                delete this.options.tab,
                                this._defaults = o,
                                this._name = n,
                                this.init(),
                                this.$element.data("plugin_tab", this)
                        }

                        s.extend(a.prototype, {
                            init: function () {
                                var n = this;
                                this.$element.find(".c-tab__switch").off("click").on("click", function (t) {
                                    t.preventDefault(),
                                        s(this).closest(".c-tab__collapse").toggleClass("is-open")
                                });
                                var t, o = this.$element.find("[data-tab-align]").data("tab-align");
                                this.$element.find("[data-tab-target]").off("switch").on("switch", function (t) {
                                    var e = s(this).data("tabTarget"),
                                        i = n.$element.find('> [data-tab-panel-id="' + e + '"]');
                                    e && i.length && (t.preventDefault(),
                                        n.$element.find("> .c-tab__header [data-tab-target], > [data-tab-panel-id]").removeClass("is-active"),
                                        n.$element.find('> .c-tab__header [data-tab-target="' + e + '"]').addClass("is-active"),
                                        i.addClass("is-active"),
                                        n.scrollAlign.call(n, o)),
                                        n.$element.find(".c-tab__collapse").removeClass("is-open")
                                }).off("click").on("click", function (t) {
                                    t.preventDefault(),
                                        s(this).trigger("switch")
                                    // 不再執行滾動效果
                                }),
                                    this.$element.find("> .c-tab__header > .c-tab__navs > [data-tab-target].is-active").trigger("switch"),
                                    this.options.docking && s.fn.scrollToFixed && this.$element.find(".c-tab__header:first").scrollToFixed({
                                        limit: function () {
                                            var t = s(this).closest('[data-tab="true"]');
                                            return t.offset().top + t.innerHeight() - s(this).outerHeight(!0)
                                        },
                                        fixed: function () {
                                            s(this).addClass("is-docking")
                                        },
                                        unfixed: function () {
                                            s(this).removeClass("is-docking")
                                        },
                                        preAbsolute: function () {
                                            s(this).addClass("is-freeze")
                                        },
                                        postAbsolute: function () {
                                            s(this).removeClass("is-freeze")
                                        },
                                        zIndex: 5
                                    });
                                const e = location.href;
                                -1 === e.indexOf("?") || -1 === e.indexOf("tab") || (t = e.split("?")[1].split("&").find(t => 0 === t.indexOf("tab"))) && "tab" === t.split("=")[0] && s(`[data-tab-target="${t = t,
                                    String(t).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#39;").split("=")[1]}"]`).trigger("switch"),
                                    this.$element.attr("data-tab", !0)
                            },
                            scrollAlign: function (t) {
                                var e = this.$element.find(".c-tab__item.is-active").closest("li"),
                                    i = this.$element.find(".c-tab__navs");
                                e = "left" === t ? e.position().left + i.scrollLeft() : e.position().left + e.width() / 2 + i.scrollLeft() - i.width() / 2,
                                    i.animate({
                                        scrollLeft: e
                                    }, 300)
                            }
                        });

                        s.fn.tab = function (e) {
                            return this.each(function () {
                                var t = s.data(this, "plugin_tab") || new a(this, e);
                                "string" == typeof e && t[e] && t[e].apply(t, Array.prototype.slice.call(arguments, 1))
                            })
                        };

                        s('[data-tab="true"]').tab();
                    })(jQuery, window);
                });

                // 觸發第一次點擊事件
                $("ul.c-tab__navs a:first").trigger("click.myEvent");
            }
             //#endregion

            //#region 查看推薦方案綁定事件
            $('#btnSolutionsSuccess').on('click', function (e) {
                e.preventDefault();
                $('[data-tab-target].is-active').trigger('click');
            });
            $('#btnSolutionsUnsuccess').on('click', function (e) {
                e.preventDefault();
                $('[data-tab-target].is-active').trigger('click');
            });
            //#endregion

            //#region 儲存試算結果按鈕綁定事件
            $('[data-save]').on('click', function (e) {
                e.preventDefault();

                var token = $('input[name="__RequestVerificationToken"]').val();

                const calculationData = {
                    Type: "RetirementPreparationList",
                    Name: "退休準備試算",
                    DateTime: moment().format('YYYY/MM/DD HH:mm'),
                    ResultHasGap: resultHasGap,
                    Description: description,
                    Readingbar: readingbar,
                    EarningsChart: earningsChart,
                    ChartsRevenues: chartsRevenues,
                    ChartsRewards: chartsRewards,
                    ChartsRewardsCategories: chartsRewardsCategories,
                    __RequestVerificationToken: token,
                    pageUrl: window.location.pathname + window.location.search
                };

                $.ajax({
                    url: '@ClientRoute.GenerateUrl(this, "Calculate", "SaveCalculationResults")',
                    type: 'POST',
                    data: calculationData,
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader("RequestVerificationToken", token);
                    }
                }).done(function (data, textStatus, jqXHR) {
                    if (data && data.success) {
                        window.toast('已儲存');
                    } else if (!data.success && data.block) {
                        window.VerifyLoginRedirctToHome(data.success);
                        return;
                    }
                }).fail(function (jqXHR, textStatus, errorThrown) {
                    console.log(errorThrown);
                }).always(function () {
                });
            });
            //#endregion

            //#region 解鎖專屬推薦綁定事件
            $('#btnUnlock').on('click', function (e) {
                e.preventDefault();

                RiskHandler().then((data) => {
                    if (data && data.success) {
                        unlockRecommendations(data);
                    } else if (!data.success && data.block) {
                        window.VerifyLoginRedirctToHome(data.success);
                        return;
                    }
                });
            });
            //#endregion

            //#region 解鎖專屬推薦方法
            function unlockRecommendations(data) {
                if (data.success && data.risk != undefined) {
                    SC_DATA.Risk = data.risk;

                    setTimeout(function (e) {
                        $.magnificPopup.open({
                            items: {
                                src: '#popupRisksuccess'
                            },
                            type: 'inline'
                        });
                        $.magnificPopup.instance.history.splice(0, $.magnificPopup.instance.history.length - 1);
                    }, 100);

                    UpdateRiskAttributesContent(data.risk);

                    $("#Recalculate").trigger('click');
                } else {
                    setTimeout(function (e) {
                        $.magnificPopup.open({
                            items: {
                                src: '#popupRiskInvalid'
                            },
                            type: 'inline'
                        });
                        $.magnificPopup.instance.history.splice(0, $.magnificPopup.instance.history.length - 1);
                    }, 100);
                }
            }
            //#endregion

            //#region 成功解鎖專屬推薦綁定事件
            $('#btnUnlocksuccess').on('click', function (e) {
                $('.Locker').removeClass('c-section--locker');
                $('.Locker').addClass('u-hidden');
                $.magnificPopup.close();
            });
            //#endregion

            //#region 連結風險屬性驗測網站綁定事件
            $(document).on('click', '#GOKYC1, #GOKYC2', function (event) {
                event.preventDefault();
                var webKycLink = '@WebKycLink';

                window.open(webKycLink, '_blank');
            });
            //#endregion

            //#region 行動裝置判斷
            if ($(window).width() < 1199) {
                let MobilePlatform = store.get("MobilePlatform") || "firste";
                let url;

                if (MobilePlatform == "firste") {
                    url = "@FirsteKycLink";
                } else {
                    url = "@IleoKycLink";
                }

                url.replaceAll('&amp;', '&');
                $(".GoKYC").attr('href', url);
            }
            //#endregion

            //#region 各欄位檢核方法
            function inputCheck(id, val) {
                var checkFlag = false;
                var inputID = "#" + id;
                var inputForm = inputID + "Form";
                var inputErrorText = inputID + "ErrorText";
                var errorMessage = "";

                var lifeExpectancyVal;
                var lifeExpectancyId;
                var yearBeginVal;
                var yearEndVal;
                var yearId;
                var payExpensesId;
                var payExpensesValId;
                var payExpensesVal;

                switch (id) {
                    case "yearBegin": // 現在年紀
                    case "yearBegin_Popup":

                        if (id == "yearBegin") {
                            lifeExpectancyVal = parseFloat($("#lifeExpectancy").val());
                            lifeExpectancyId = "#lifeExpectancy";
                            yearEndVal = parseFloat($("#yearEnd").val());
                            yearId = "#year";
                            payExpensesId = "#payExpenses";
                            payExpensesValId = "#payExpensesVal";
                        }
                        else {
                            lifeExpectancyVal = parseFloat($("#lifeExpectancy_Popup").val());
                            lifeExpectancyId = "#lifeExpectancy_Popup";
                            yearEndVal = parseFloat($("#yearEnd_Popup").val());
                            yearId = "#year_Popup";
                            payExpensesId = "#payExpenses_Popup";
                            payExpensesValId = "#payExpensesVal_Popup";
                        }

                        payExpensesVal = lifeExpectancyVal - yearEndVal;

                        if (parseFloat(val) >= lifeExpectancyVal) {
                            yearErrorMessage = "現在年紀應小於預計退休年齡及預期壽命";
                            lifeExpectancErrorMessage = "預期壽命應大於現在年紀及預計退休年齡";

                            $(yearId + "ErrorText").text(yearErrorMessage);
                            $(yearId + "Form").addClass('is-error');
                            $(lifeExpectancyId + "ErrorText").text(lifeExpectancErrorMessage);
                            $(lifeExpectancyId + "Form").addClass('is-error');
                            $(payExpensesId).addClass('u-hidden');
                            checkFlag = false;
                        } else if ((parseFloat(val) < lifeExpectancyVal) && (yearEndVal >= lifeExpectancyVal)) {
                            lifeExpectancErrorMessage = "預期壽命應大於現在年紀及預計退休年齡";

                            $(yearId + "Form").removeClass('is-error');
                            $(lifeExpectancyId + "ErrorText").text(lifeExpectancErrorMessage);
                            $(lifeExpectancyId + "Form").addClass('is-error');
                            $(payExpensesId).addClass('u-hidden');
                            checkFlag = true;
                        } else {
                            $(yearId + "Form").removeClass('is-error');
                            $(lifeExpectancyId + "Form").removeClass('is-error');
                            $(payExpensesId).removeClass('u-hidden');
                            $(payExpensesValId).text(payExpensesVal);
                            checkFlag = true;
                        }

                        $(inputID).val(val);
                        break;
                    case "yearEnd": // 退休年齡
                    case "yearEnd_Popup":

                        if (id == "yearEnd") {
                            lifeExpectancyVal = parseFloat($("#lifeExpectancy").val());
                            lifeExpectancyId = "#lifeExpectancy";
                            payExpensesId = "#payExpenses";
                            payExpensesValId = "#payExpensesVal";
                        }
                        else {
                            lifeExpectancyVal = parseFloat($("#lifeExpectancy_Popup").val());
                            lifeExpectancyId = "#lifeExpectancy_Popup";
                            payExpensesId = "#payExpenses_Popup";
                            payExpensesValId = "#payExpensesVal_Popup";
                        }

                        payExpensesVal = lifeExpectancyVal - parseFloat(val);

                        if (parseFloat(val) >= lifeExpectancyVal) {
                            errorMessage = "預期壽命應大於現在年紀及預計退休年齡";

                            $(lifeExpectancyId + "ErrorText").text(errorMessage);
                            $(lifeExpectancyId + "Form").addClass('is-error');
                            $(payExpensesId).addClass('u-hidden');
                            checkFlag = true;
                        } else {
                            $(lifeExpectancyId + "Form").removeClass('is-error');
                            $(payExpensesId).removeClass('u-hidden');
                            $(payExpensesValId).text(payExpensesVal);
                            checkFlag = true;
                        }

                        $(inputID).val(val);
                        break;
                    case "lifeExpectancy": // 預期壽命
                    case "lifeExpectancy_Popup":

                        if (id == "lifeExpectancy") {
                            yearBeginVal = parseFloat($("#yearBegin").val());
                            yearEndVal = parseFloat($("#yearEnd").val());
                            yearId = "#year";
                            payExpensesId = "#payExpenses";
                            payExpensesValId = "#payExpensesVal";
                        }
                        else {
                            yearBeginVal = parseFloat($("#yearBegin_Popup").val());
                            yearEndVal = parseFloat($("#yearEnd_Popup").val());
                            yearId = "#year_Popup";
                            payExpensesId = "#payExpenses_Popup";
                            payExpensesValId = "#payExpensesVal_Popup";
                        }

                        payExpensesVal = parseFloat(val) - yearEndVal;

                        if (val == "" || isNaN(val)) {
                            errorMessage = "此欄位為必填";

                            $(yearId + "Form").removeClass('is-error');
                            $(payExpensesId).addClass('u-hidden');
                            checkFlag = false;
                        } else if (parseFloat(val) > yearBeginVal && parseFloat(val) <= yearEndVal) {
                            errorMessage = "預期壽命應大於現在年紀及預計退休年齡";

                            $(yearId + "Form").removeClass('is-error');
                            $(payExpensesId).addClass('u-hidden');
                            checkFlag = false;
                        } else if (parseFloat(val) <= yearBeginVal) {
                            yearErrorMessage = "現在年紀應小於預計退休年齡及預期壽命";
                            errorMessage = "預期壽命應大於現在年紀及預計退休年齡";

                            $(yearId + "ErrorText").text(yearErrorMessage);
                            $(yearId + "Form").addClass('is-error');
                            $(payExpensesId).addClass('u-hidden');
                            checkFlag = false;
                        } else {
                            $(yearId + "Form").removeClass('is-error');
                            $(payExpensesId).removeClass('u-hidden');
                            $(payExpensesValId).text(payExpensesVal);
                            checkFlag = true;
                        }

                        $(inputID).val(val);
                        break;
                    case "currentMonthlyCost": // 現階段每月花費
                    case "currentMonthlyCost_Popup":

                        if (val == "" || isNaN(val)) {
                            errorMessage = "此欄位為必填";
                            checkFlag = false;
                        } else {
                            checkFlag = true;
                        }

                        $(inputID).val(val);
                        break;
                    case "retireMonthlyCost": // 退休後每月花費(家庭)
                    case "retireMonthlyCost_Popup":

                        if (val == "" || isNaN(val)) {
                            errorMessage = "此欄位為必填";
                            checkFlag = false;
                        } else {
                            checkFlag = true;
                        }

                        $(inputID).val(val);
                        break;
                    case "amountPrepared": // 已準備金額
                    case "amountPrepared_Popup":

                        if (val == "" || isNaN(val)) {
                            errorMessage = "此欄位為必填";
                            checkFlag = false;
                        } else {
                            checkFlag = true;
                        }

                        $(inputID).val(val);
                        break;
                    case "pension": // 預估法定退休金
                    case "pension_Popup":

                        if (val == "" || isNaN(val)) {
                            errorMessage = "此欄位為必填";
                            checkFlag = false;
                        } else {
                            checkFlag = true;
                        }

                        $(inputID).val(val);
                        break;
                    default:
                        return;
                }

                if (checkFlag) {
                    $(inputForm).removeClass('is-error');
                }
                else {
                    $(inputErrorText).text(errorMessage);
                    $(inputForm).addClass('is-error');
                }

                return checkFlag;
            }
            //#endregion

            //#region 點擊後檢核每個欄位方法
            function clickCheck() {
                var checkBox = [];

                $("#yearBegin, #yearEnd, #lifeExpectancy, #currentMonthlyCost, #retireMonthlyCost, #amountPrepared, #pension, #yearBegin_Popup, #yearEnd_Popup, #lifeExpectancy_Popup, #currentMonthlyCost_Popup, #retireMonthlyCost_Popup, #amountPrepared_Popup, #pension_Popup").each(function (i, obj) {
                    var inputID = obj.id;
                    var val = obj.value;
                    checkBox.push(inputCheck(inputID, val));
                });

                var checkFlag = checkBox.every(function (item) {
                    return item;
                });

                return checkFlag;
            };
            //#endregion

            //#region 開頭去 "0" 和 "." 方法
            function trimZeroAndDot(val) {
                var flag = false;
                const zeroReg = /^0/g;
                const dotReg = /^\./;

                // 移除前導零
                while (zeroReg.test(val)) {
                    val = val.replace(zeroReg, "");
                    flag = true;
                }

                // 如果結果在移除零後為空字串，設為 "0"
                if (flag && val == "") {
                    val = "0";
                }

                // 如果字串以 "." 開頭，前面加上 "0"
                if (dotReg.test(val)) {
                    val = "0" + val;
                }

                return val;
            }
            //#endregion

            //#region Div移除屬性
            function divRemoveAttributes($div) {
                if (!$div || !$div.jquery || $div.length === 0) {
                    return;
                }

                // 獲取除 'id' 之外的所有屬性名稱
                var attributes = $.map($div[0].attributes, function (attr) {
                    return attr.name !== 'id' ? attr.name : null;
                });

                // 移除所有非 'id' 屬性
                $div.removeAttr(attributes.join(' '));
            }
             //#endregion

            //#region 退休至臨終所需花費(目標金額) - 試算方法
            function targetAmountCompute(lifeExpectancy, yearEnd, retireMonthlyCost) {

                // 預期壽命
                let lifeExpectancyVal = parseFloat(lifeExpectancy);

                // 預計退休歲數
                let yearEndVal = parseFloat(yearEnd);

                // 退休後每月花費
                let retireMonthlyCostVal = parseFloat(retireMonthlyCost) * 10000;

                let result = ((lifeExpectancyVal - yearEndVal) * 12) * retireMonthlyCostVal;

                return result;
            };
            //#endregion

            //#region 期末總金額A (總收益：含法定退休金) - 試算方法
            function totalACompute(years, amountPrepared, monthlyInvestment, expectedRoi, pension) {

                // 預計幾年後達成目標
                let yearsVal = parseFloat(years) * 12;

                // 已準備金額
                let amountPreparedVal = parseFloat(amountPrepared) * 10000;

                // 每月投入金額
                let monthlyInvestmentVal = parseFloat(monthlyInvestment) * 10000;

                // 預期投資報酬率
                let expectedRoiVal = parseFloat(expectedRoi) / 12 / 100;

                // 預估法定退休金
                let pensionVal = parseFloat(pension) * 10000;

                return Math.round(formulajs.FV(expectedRoiVal, yearsVal, -monthlyInvestmentVal, -amountPreparedVal, 0) + pensionVal);
            };
            //#endregion

            //#region 推薦方案1-試算方法
            function tab2Compute(years, totalB, expectedRoi, monthlyInvestment) {
                // 年期
                let yearsVal = parseFloat(years) * 12;

                // 預期投資報酬率
                let expectedRoiVal = parseFloat(expectedRoi) / 12 / 100;

                // 每月還需投入
                let rmi = formulajs.ROUNDUP(formulajs.PMT(expectedRoiVal, yearsVal, totalB), -3);

                // 每月總投入
                let result = rmi + parseFloat(monthlyInvestment) * 10000;

                return result;
            };
            //#endregion

            //#region 推薦方案2-試算方法
            function tab3Compute(years, monthlyInvestment, amountPrepared, targetAmount, pension) {
                // 年期
                let yearsVal = parseFloat(years) * 12;

                // 每月投入金額
                let monthlyInvestmentVal = parseFloat(monthlyInvestment) * 10000;

                // 已準備金額
                let amountPreparedVal = parseFloat(amountPrepared) * 10000;

                // 預估法定退休金
                let pensionVal = parseFloat(pension) * 10000;

                // 缺口 (退休至臨終所需花費 - 法定退休金)
                let gap = targetAmount - pensionVal;

                return formulajs.ROUNDUP(formulajs.RATE(yearsVal, -monthlyInvestmentVal, -amountPreparedVal, gap) * 12, 4);
            };
            //#endregion

            //#region 圖表資料清除
            function clearChartDatas() {
                description = "";
                readingbar.length = 0
                earningsChart.length = 0
                chartsRevenues.length = 0;
                chartsRewards.length = 0;
                chartsRewardsCategories.length = 0;
                chartsAssets.length = 0;
            }
             //#endregion

            //#region 顯示試算結果 - 描述區塊
            function renderResultDescription(yearBegin, yearEnd, amountPrepared, pension, years, targetAmount, totalA, totalB) {

                let current;
                let targetAmountVal = targetAmount.toLocaleString();
                let amountPreparedVal = (parseFloat(amountPrepared) * 10000).toLocaleString();
                let pensionVal = (parseFloat(pension) * 10000).toLocaleString();
                let retirementYear = parseFloat(yearEnd) - parseFloat(yearBegin);
                let totalBVal

                if (totalB < 0) {
                    totalB = -totalB;
                    totalBVal = totalB.toLocaleString();
                    resultHasGap = true;
                } else {
                    totalB = 0;
                    totalBVal = 0;
                    resultHasGap = false;
                }

                let htmlString = `<div class="l-calcResult__desc t-bold s3">
                            我目標 ${yearEnd} 歲退休，應準備退休金 ${targetAmountVal} ​元，現已準備 ${amountPreparedVal} 元及退休後可領預估法定退休金 ${pensionVal} 元，上述將支應 ${years} 年的花費。
                    </div>
                    <div class="l-calcResult__desc t-bold s3">
                        目前離 ${retirementYear} 年後退休，尚需額外準備
                        <span class="t1 t-warning u-nowrap">${totalBVal}元</span>
                    </div>
                    <div class="l-calcResult__charts">
                        <div id="chartsGap"></div>
                    </div>`;

                $("#resultContent").html(htmlString);

                if (resultHasGap) {
                    $("#resultSuccessMain").addClass("u-hidden");
                    $("#resultUnsuccessfulMain").removeClass("u-hidden");
                    current = totalA;
                } else {
                    $("#resultSuccessMain").removeClass("u-hidden");
                    $("#resultUnsuccessfulMain").addClass("u-hidden");
                    current = targetAmount;
                }

                divRemoveAttributes($('#chartsGap'));
                $('#chartsGap').empty();

                description = encodeURIComponent($('#resultDescription').prop('outerHTML').replace(/(\n\s*)+/g, '\n'));

                // 試算結果讀條顯示
                renderReadingbar('chartsGap', targetAmount, current, totalB);
            }
            //#endregion

            //#region 顯示試算結果 - tab1區塊
            function renderResultTab1(result, totalB, targetAmount, years, pension, amountPrepared, monthlyInvestment, expectedRoi) {
                let resultFormatVal = result.toLocaleString();
                let currentYear = new Date().getFullYear() + years - 1;
                let gap;

                if (totalB < 0) {
                    gap = -totalB;
                } else {
                    gap = 0;
                }

                let invest = (parseFloat(monthlyInvestment) * 10000) * parseFloat(years) * 12;
                let retire = parseFloat(pension) * 10000;
                let prepared = parseFloat(amountPrepared) * 10000;

                // 預期總收益
                $("#tab1_Total").text(resultFormatVal + "元");
                // 預估退休金
                $("#tab1_Pension").text(parseFloat(pension).toLocaleString() + " 萬元");
                // 每月投入
                $("#tab1_MonthlyInvestment").text(parseFloat(monthlyInvestment).toLocaleString() + " 萬元");
                // 投資報酬率
                $("#tab1_ExpectedRoi").text(expectedRoi + " %");
                // 距離離退休還有多少年
                $("#tab1_Years").text(years + " 年");
                // 預期收益標題
                $("#tab1_ExpectedReturnTitle").text(currentYear + "年預期收益");

                divRemoveAttributes($('#chartsRevenue-01'));
                $('#chartsRevenue-01').empty();

                divRemoveAttributes($('#chartsReward-01'));
                $('#chartsReward-01').empty();

                let tab1_earningsChart = $('#tab1_earningsChart').prop('outerHTML').replace(/(\n\s*)+/g, '\n');

                earningsChart.push(encodeURIComponent(tab1_earningsChart));

                // tab1圓餅圖資料
                chartsRevenues.push({
                    id: 'chartsRevenue-01',
                    gap: gap,
                    revenue: result - invest - prepared - retire,
                    invest: invest,
                    retire: retire,
                    prepared: prepared
                });

                // tab1長條圖資料
                chartsRewards.push({
                    id: 'chartsReward-01',
                    target: targetAmount,
                    gap: getRewardsGapData(gap, years),
                    revenue: getRewardsRevenueData(monthlyInvestment, amountPrepared, years, expectedRoi, pension),
                    invest: getRewardsInvestData(monthlyInvestment, years),
                    retire: getReservedFundsOrPensionsData(pension, years),
                    prepared: getReservedFundsOrPensionsData(amountPrepared, years)
                });

                // tab1資產配置資料
                chartsAssets.push({
                    id: 'chartsAssets-01',
                    currency: assetsData.currency.number,
                    bond: assetsData.bond.number,
                    stock: assetsData.stock.number
                });

                if (SC_DATA.Risk !== undefined) {
                    let tab = "tab1";
                    let event = $('[data-tab-panel-id="tab-1"] .recommendedFunds .swiper-wrapper');
                    let eventString = '[data-tab-panel-id="tab-1"] .recommendedFunds';
                    getFundData(tab, event, eventString, years, monthlyInvestment, amountPrepared, targetAmount, pension, expectedRoi);

                    let eventEtf = $('[data-tab-panel-id="tab-1"] .recommendedETF .swiper-wrapper');
                    let eventStringEtf = '[data-tab-panel-id="tab-1"] .recommendedETF';
                    getEtfData(tab, eventEtf, eventStringEtf, years, monthlyInvestment, amountPrepared, targetAmount, pension, expectedRoi);
                } else if (!SC_DATA.IsLoggedIn || (SC_DATA.PlatForm == 'WebBank' && SC_DATA.Risk == undefined)) {
                    if (!hasRenderedRecommendations) {
                        renderRecommendedFunds(9);
                        renderRecommendedETFs(3);
                        renderRecommendedProductChart();
                        hasRenderedRecommendations = true;
                    }
                } else if (SC_DATA.PlatForm == 'Line' || SC_DATA.PlatForm == 'FaceBook') {
                    $('#tab1RiskAsset').addClass('u-hidden');
                    $('#tab1Fund').addClass('u-hidden');
                    $('#tab1ETF').addClass('u-hidden');
                }
            }
            //#endregion

            //#region 顯示試算結果 - tab2區塊
            function renderResultTab2(result, targetAmount, years, amountPrepared, pension, expectedRoi) {
                let resultFormatVal = (result / 10000).toLocaleString();
                let currentYear = new Date().getFullYear() + years - 1;
                let total = totalACompute(years, amountPrepared, (result / 10000), expectedRoi, pension);
                let totalFormatVal = total.toLocaleString();

                let invest = result * parseFloat(years) * 12;
                let retire = parseFloat(pension) * 10000;
                let prepared = parseFloat(amountPrepared) * 10000;

                // 預期總收益
                $("#tab2_Total").text(totalFormatVal + "元");
                // 預估退休金
                $("#tab2_Pension").text(parseFloat(pension).toLocaleString() + " 萬元");
                // 每月投入
                $("#tab2_MonthlyInvestment").text(resultFormatVal.toLocaleString() + " 萬元");
                // 投資報酬率
                $("#tab2_ExpectedRoi").text(expectedRoi + " %");
                // 距離離退休還有多少年
                $("#tab2_Years").text(years + " 年");
                // 預期收益標題
                $("#tab2_ExpectedReturnTitle").text(currentYear + "年預期收益");

                divRemoveAttributes($('#chartsRevenue-02'));
                $('#chartsRevenue-02').empty();

                divRemoveAttributes($('#chartsReward-02'));
                $('#chartsReward-02').empty();

                let tab2_earningsChart = $('#tab2_earningsChart').prop('outerHTML').replace(/(\n\s*)+/g, '\n');

                earningsChart.push(encodeURIComponent(tab2_earningsChart));

                // tab2圓餅圖資料
                chartsRevenues.push({
                    id: 'chartsRevenue-02',
                    gap: 0,
                    revenue: total - invest - prepared - retire,
                    invest: invest,
                    retire: retire,
                    prepared: prepared
                });

                // tab2長條圖資料
                chartsRewards.push({
                    id: 'chartsReward-02',
                    target: targetAmount,
                    gap: getRewardsGapData(0, years),
                    revenue: getRewardsRevenueData((result / 10000), amountPrepared, years, expectedRoi, pension),
                    invest: getRewardsInvestData((result / 10000), years),
                    retire: getReservedFundsOrPensionsData(pension, years),
                    prepared: getReservedFundsOrPensionsData(amountPrepared, years)
                });

                // tab2資產配置資料
                chartsAssets.push({
                    id: 'chartsAssets-02',
                    currency: assetsData.currency.number,
                    bond: assetsData.bond.number,
                    stock: assetsData.stock.number
                });

                if (SC_DATA.Risk !== undefined) {
                    let tab = "tab2";

                    let event = $('[data-tab-panel-id="tab-2"] .recommendedFunds .swiper-wrapper');
                    let eventString = '[data-tab-panel-id="tab-2"] .recommendedFunds';
                    getFundData(tab, event, eventString, years, result, amountPrepared, targetAmount, pension, expectedRoi);

                    let eventEtf = $('[data-tab-panel-id="tab-2"] .recommendedETF .swiper-wrapper');
                    let eventStringEtf = '[data-tab-panel-id="tab-2"] .recommendedETF';
                    getEtfData(tab, eventEtf, eventStringEtf, years, result, amountPrepared, targetAmount, pension, expectedRoi);

                } else if (SC_DATA.PlatForm == 'Line' || SC_DATA.PlatForm == 'FaceBook') {
                    $('#tab2RiskAsset').addClass('u-hidden');
                    $('#tab2Fund').addClass('u-hidden');
                    $('#tab2ETF').addClass('u-hidden');
                }
            }
            //#endregion

            //#region 顯示試算結果 - tab3區塊
            function renderResultTab3(result, targetAmount, years, amountPrepared, pension, monthlyInvestment) {
                let resultFormatVal = (result * 100).toFixed(2);
                let currentYear = new Date().getFullYear() + years - 1;
                let total = totalACompute(years, amountPrepared, monthlyInvestment, resultFormatVal, pension);
                let totalFormatVal = total.toLocaleString();

                let invest = (parseFloat(monthlyInvestment) * 10000) * parseFloat(years) * 12;
                let retire = parseFloat(pension) * 10000;
                let prepared = parseFloat(amountPrepared) * 10000;

                // 預期總收益
                $("#tab3_Total").text(totalFormatVal + "元");
                // 預估退休金
                $("#tab3_Pension").text(parseFloat(pension).toLocaleString() + " 萬元");
                // 每月投入
                $("#tab3_MonthlyInvestment").text(parseFloat(monthlyInvestment).toLocaleString() + " 萬元");
                // 投資報酬率
                $("#tab3_ExpectedRoi").text(resultFormatVal + " %");
                // 距離離退休還有多少年
                $("#tab3_Years").text(years + " 年");
                // 預期收益標題
                $("#tab3_ExpectedReturnTitle").text(currentYear + "年預期收益");

                divRemoveAttributes($('#chartsRevenue-03'));
                $('#chartsRevenue-03').empty();

                divRemoveAttributes($('#chartsReward-03'));
                $('#chartsReward-03').empty();

                let tab3_earningsChart = $('#tab3_earningsChart').prop('outerHTML').replace(/(\n\s*)+/g, '\n');

                earningsChart.push(encodeURIComponent(tab3_earningsChart));

                // tab3圓餅圖資料
                chartsRevenues.push({
                    id: 'chartsRevenue-03',
                    gap: 0,
                    revenue: total - invest - prepared - retire,
                    invest: invest,
                    retire: retire,
                    prepared: prepared
                });

                // tab3長條圖資料
                chartsRewards.push({
                    id: 'chartsReward-03',
                    target: targetAmount,
                    gap: getRewardsGapData(0, years),
                    revenue: getRewardsRevenueData(monthlyInvestment, amountPrepared, years, resultFormatVal, pension),
                    invest: getRewardsInvestData(monthlyInvestment, years),
                    retire: getReservedFundsOrPensionsData(pension, years),
                    prepared: getReservedFundsOrPensionsData(amountPrepared, years)
                });

                // tab3資產配置資料
                chartsAssets.push({
                    id: 'chartsAssets-03',
                    currency: assetsData.currency.number,
                    bond: assetsData.bond.number,
                    stock: assetsData.stock.number
                });

                if (SC_DATA.Risk !== undefined) {
                    let tab = "tab3";

                    let event = $('[data-tab-panel-id="tab-3"] .recommendedFunds .swiper-wrapper');
                    let eventString = '[data-tab-panel-id="tab-3"] .recommendedFunds';
                    getFundData(tab, event, eventString, years, monthlyInvestment, amountPrepared, targetAmount, pension, result);

                    let eventEtf = $('[data-tab-panel-id="tab-3"] .recommendedETF .swiper-wrapper');
                    let eventStringEtf = '[data-tab-panel-id="tab-3"] .recommendedETF';
                    getEtfData(tab, eventEtf, eventStringEtf, years, monthlyInvestment, amountPrepared, targetAmount, pension, result);

                } else if (SC_DATA.PlatForm == 'Line' || SC_DATA.PlatForm == 'FaceBook') {
                    $('#tab3RiskAsset').addClass('u-hidden');
                    $('#tab3Fund').addClass('u-hidden');
                    $('#tab3ETF').addClass('u-hidden');
                }
            }
            //#endregion

            //#region 顯示試算結果 - tab4區塊
            function renderResultTab4(result, targetAmount, years, amountPrepared, pension, monthlyInvestment, expectedRoi) {
                let resultFormatVal = result.toLocaleString();
                let expectedRoiFormatVal = parseFloat(expectedRoi).toFixed(2);
                let currentYear = new Date().getFullYear() + years - 1;

                let invest = (parseFloat(monthlyInvestment) * 10000) * parseFloat(years) * 12;
                let retire = parseFloat(pension) * 10000;
                let prepared = parseFloat(amountPrepared) * 10000;

                // 預期總收益
                $("#tab4_Total").text(resultFormatVal + "元");
                // 預估退休金
                $("#tab4_Pension").text(parseFloat(pension).toLocaleString() + " 萬元");
                // 每月投入
                $("#tab4_MonthlyInvestment").text(parseFloat(monthlyInvestment).toLocaleString() + " 萬元");
                // 投資報酬率
                $("#tab4_ExpectedRoi").text(expectedRoiFormatVal + " %");
                // 距離離退休還有多少年
                $("#tab4_Years").text(years + " 年");
                // 預期收益標題
                $("#tab4_ExpectedReturnTitle").text(currentYear + "年預期收益");

                divRemoveAttributes($('#chartsRevenue-04'));
                $('#chartsRevenue-04').empty();

                divRemoveAttributes($('#chartsReward-04'));
                $('#chartsReward-04').empty();

                let tab4_earningsChart = $('#tab4_earningsChart').prop('outerHTML').replace(/(\n\s*)+/g, '\n');

                earningsChart.push(encodeURIComponent(tab4_earningsChart));

                // tab4圓餅圖資料
                chartsRevenues.push({
                    id: 'chartsRevenue-04',
                    gap: 0,
                    revenue: result - invest - prepared - retire,
                    invest: invest,
                    retire: retire,
                    prepared: prepared
                });

                // tab4長條圖資料
                chartsRewards.push({
                    id: 'chartsReward-04',
                    target: targetAmount,
                    gap: getRewardsGapData(0, years),
                    revenue: getRewardsRevenueData(monthlyInvestment, amountPrepared, years, expectedRoi, pension),
                    invest: getRewardsInvestData(monthlyInvestment, years),
                    retire: getReservedFundsOrPensionsData(pension, years),
                    prepared: getReservedFundsOrPensionsData(amountPrepared, years)
                });

                // tab4資產配置資料
                chartsAssets.push({
                    id: 'chartsAssets-04',
                    currency: assetsData.currency.number,
                    bond: assetsData.bond.number,
                    stock: assetsData.stock.number
                });

                if (SC_DATA.Risk !== undefined) {
                    let tab = "tab4";

                    let event = $('[data-tab-panel-id="tab-4"] .recommendedFunds .swiper-wrapper');
                    let eventString = '[data-tab-panel-id="tab-4"] .recommendedFunds';
                    getFundData(tab, event, eventString, years, monthlyInvestment, amountPrepared, targetAmount, pension, expectedRoi);

                    let eventEtf = $('[data-tab-panel-id="tab-4"] .recommendedETF .swiper-wrapper');
                    let eventStringEtf = '[data-tab-panel-id="tab-4"] .recommendedETF';
                    getEtfData(tab, eventEtf, eventStringEtf, years, monthlyInvestment, amountPrepared, targetAmount, pension, expectedRoi);

                } else if (SC_DATA.PlatForm == 'Line' || SC_DATA.PlatForm == 'FaceBook') {
                    $('#tab4RiskAsset').addClass('u-hidden');
                    $('#tab4Fund').addClass('u-hidden');
                    $('#tab4ETF').addClass('u-hidden');
                }
            }
            //#endregion

            //#region 試算結果讀條顯示
            function renderReadingbar(containerId, target, current, gap) {
                const data = {
                    target: Number(target),
                    current: Number(current),
                    gap: Number(gap)
                };

                readingbar = data;

                Highcharts.chart(containerId, {
                    chart: {
                        type: 'bar',
                        height: '81px',
                        spacing: [16, 0, 0, 0],
                        backgroundColor: 'transparent',
                        style: {
                            fontFamily: 'Microsoft JhengHei, Arial, Helvetica, sans-serif',
                            fontSize: '16px'
                        }
                    },
                    title: {
                        text: undefined
                    },
                    xAxis: {
                        visible: false
                    },
                    yAxis: {
                        tickAmount: 2,
                        tickInterval: 0,
                        reversedStacks: false,
                        title: {
                            enabled: false
                        },
                        labels: {
                            format: '{value:,f} 元',
                            padding: 0,
                            y: 16,
                            style: {
                                color: '#9C9C9C',
                                fontSize: '14px'
                            }
                        },
                        max: data.target
                    },
                    legend: {
                        enabled: false
                    },
                    credits: {
                        enabled: false
                    },
                    plotOptions: {
                        series: {
                            pointWidth: 40,
                            stacking: 'normal'
                        }
                    },
                    tooltip: {
                        headerFormat: undefined,
                        format: '<div class="o-chartsTooltips">{y:,.f} 元</div>',
                        useHTML: true,
                        padding: 0,
                        backgroundColor: 'transparent',
                        style: {
                            fontFamily: 'Microsoft JhengHei, Arial, Helvetica, sans-serif',
                            fontSize: '16px'
                        },
                        outside: true,
                        positioner(w, h, point) {
                            const tooltips = $(this.container).find('.o-chartsTooltips').removeClass('o-chartsTooltips--left o-chartsTooltips--right');
                            let x = point.plotX - point.h / 2 - w / 2,
                                y = 0;
                            if (x < 0) {
                                x = point.plotX + 8;
                                y = 24;
                                tooltips.addClass('o-chartsTooltips--right');
                            }
                            if (x + w > this.chart.plotWidth) {
                                x = point.plotX - point.h - w - 8;
                                y = 24;
                                tooltips.addClass('o-chartsTooltips--left');
                            }
                            return {
                                x: x,
                                y: y
                            };
                        }
                    },
                    series: [{
                        name: '已準備金額',
                        data: [data.current],
                        color: '#FDCE5E'
                    }, {
                        name: '缺口',
                        data: [data.gap],
                        color: {
                            pattern: {
                                image: '/themes/images/background/slash-column.svg',
                                width: 8,
                                height: 8
                            }
                        }
                    }]
                });
            }
            //#endregion

            //#region 預期收益圓餅圖顯示
            function renderChartsRevenues(chartsRevenues) {
                chartsRevenues.forEach(item => {
                    Highcharts.chart(item.id, {
                        chart: {
                            type: 'pie'
                        },
                        title: {
                            text: undefined
                        },
                        tooltip: {
                            pointFormat: '{point.name}：{point.y}',
                            headerFormat: undefined,
                            style: {
                                fontFamily: 'Microsoft JhengHei, Arial, Helvetica, sans-serif',
                                fontSize: '16px'
                            },
                            shadow: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        legend: {
                            layout: 'vertical',
                            labelFormat: '{name}：{y:,.0f}元',
                            align: 'center',
                            verticalAlign: 'bottom',
                            itemMarginTop: 8,
                            itemStyle: {
                                font: '1em Microsoft JhengHei, Arial, Helvetica, sans-serif',
                                cursor: 'default'
                            }
                        },
                        credits: {
                            enabled: false
                        },
                        plotOptions: {
                            pie: {
                                showInLegend: true,
                                dataLabels: false,
                                height: 246,
                                point: {
                                    events: {
                                        legendItemClick: function (e) {
                                            e.preventDefault();
                                        }
                                    }
                                }
                            }
                        },
                        series: [{
                            name: '2048年預期收益',
                            colorByPoint: true,
                            data: [{
                                name: '缺口',
                                y: item.gap,
                                color: {
                                    pattern: {
                                        image: '/themes/images/background/slash-pie.svg',
                                        width: 8,
                                        height: 8
                                    }
                                },
                                sliced: true
                            }, {
                                name: '報酬',
                                y: item.revenue,
                                color: '#ABA1E4'
                            }, {
                                name: '累積每月投入',
                                y: item.invest,
                                color: '#86BDDD'
                            }, {
                                name: '預估法定退休金',
                                y: item.retire,
                                color: '#238C6C'
                            }, {
                                name: '已準備金',
                                y: item.prepared,
                                color: '#FFAD04'
                            }]
                        }]
                    });
                });
            }
            //#endregion

            //#region 取得長條圖缺口資料
            function getRewardsGapData(gap, years) {
                let data = [];

                for (let i = 0; i < parseFloat(years); i++) {
                    if (i === parseFloat(years) - 1) {
                        data.push(gap);
                    } else {
                        data.push(null);
                    }
                }

                return data;
            }
            //#endregion

            //#region 取得長條圖報酬資料
            function getRewardsRevenueData(monthlyInvestment, amountPrepared, years, expectedRoi, pension) {
                let data = [];

                for (let i = 1; i <= parseFloat(years); i++) {
                    let result = totalACompute(i, amountPrepared, monthlyInvestment, expectedRoi, pension)
                        - (parseFloat(amountPrepared) * 10000)
                        - ((parseFloat(monthlyInvestment) * 10000) * i * 12)
                        - (parseFloat(pension) * 10000);

                    data.push(result);
                }

                return data;
            }
            //#endregion

            //#region 取得長條圖累積每月投入資料
            function getRewardsInvestData(monthlyInvestment, years) {
                let data = [];

                for (let i = 1; i <= parseFloat(years); i++) {
                    data.push((parseFloat(monthlyInvestment) * 10000) * 12 * i);
                }

                return data;
            }
            //#endregion

            //#region 取得長條圖已準備金或預估退休金資料
            function getReservedFundsOrPensionsData(amountPrepared, years) {
                let data = [];

                for (let i = 0; i < parseFloat(years); i++) {
                    data.push((parseFloat(amountPrepared) * 10000));
                }

                return data;
            }
            //#endregion

            //#region 取得長條圖年份顯示範圍
            function getRewardsYearsRange(currentYear) {
                let startYear = new Date().getFullYear();
                for (let year = startYear; year <= currentYear; year++) {
                    chartsRewardsCategories.push(year.toString());
                }
            }
            //#endregion

            //#region 投資報酬長條圖顯示
            function renderChartsRewards(chartsRewards) {
                chartsRewards.forEach(item => {
                    Highcharts.chart(item.id, {
                        chart: {
                            maxWidth: '100%',
                            height: 400,
                            type: 'column',
                            style: {
                                fontFamily: 'Microsoft JhengHei, Arial, Helvetica, sans-serif',
                                fontSize: '16px'
                            }
                        },
                        title: {
                            text: undefined
                        },
                        xAxis: {
                            categories: chartsRewardsCategories
                        },
                        yAxis: {
                            allowDecimals: false,
                            min: 0,
                            title: {
                                text: undefined
                            },
                            labels: {
                                formatter: function () {
                                    const dividend = 10000,
                                        units = ['元', '萬', '億', '萬億'];
                                    let result = {};
                                    if (this.value < dividend) {
                                        result.value = Number(this.value);
                                        result.unit = units[0];
                                    } else {
                                        let index = Math.floor(Math.log(this.value) / Math.log(dividend));
                                        result.value = Number(this.value / Math.pow(dividend, index));
                                        result.unit = units[index];
                                    }
                                    return result.value + result.unit;
                                }
                            },
                            plotLines: [{
                                color: '#F58220',
                                width: 3,
                                value: item.target,
                                zIndex: 4,
                                label: {
                                    text: '目標金額',
                                    align: 'left',
                                    x: 0,
                                    y: -8,
                                    style: {
                                        color: '#F58220',
                                        fontSize: '16px',
                                        fontWeight: 'bold'
                                    }
                                }
                            }]
                        },
                        tooltip: {
                            enabled: true,
                            shared: true,
                            useHTML: true,
                            formatter: function () {
                                let tooltip = '';
                                this.points.forEach(function (point) {
                                    let bg = `background-color: ${point.color};`;
                                    if (point.color.pattern && point.color.pattern.image) {
                                        bg = `background: url(${point.color.pattern.image}) repeat left top / 6px;`;
                                    }
                                    tooltip += `<div style="display: flex; align-items: center; gap: 4px; margin: 8px 0;">
                                <span style="display: block; width: 12px; height: 12px; border-radius: 50%; ${bg}"></span>
                                <span>${point.series.name}：${Highcharts.numberFormat(point.y, 0)}</span>
                            </div>`;
                                });
                                const index = this.points.findIndex(x => x.series.userOptions.name === '缺口');
                                if (index > -1) {
                                    this.total -= this.points[index].y;
                                }
                                tooltip += `<div style="margin: 8px 0;">預期收益：${Highcharts.numberFormat(this.total, 0)}</div>`;
                                return tooltip;
                            },
                            style: {
                                fontFamily: 'Microsoft JhengHei, Arial, Helvetica, sans-serif',
                                fontSize: '16px'
                            },
                            shadow: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        legend: {
                            align: 'left',
                            itemStyle: {
                                font: '1em Microsoft JhengHei, Arial, Helvetica, sans-serif',
                                cursor: 'default'
                            }
                        },
                        plotOptions: {
                            column: {
                                stacking: 'normal',
                                groupPadding: 0.1,
                                maxPointWidth: 80,
                                events: {
                                    legendItemClick: function () {
                                        return false;
                                    }
                                }
                            },
                            series: {
                                states: {
                                    inactive: {
                                        opacity: 1
                                    }
                                }
                            }
                        },
                        credits: {
                            enabled: false
                        },
                        series: [{
                            name: "缺口",
                            data: item.gap,
                            color: {
                                pattern: {
                                    image: '/themes/images/background/slash-column.svg',
                                    width: 8,
                                    height: 8
                                }
                            },
                            borderWidth: 2,
                            borderColor: '#FF0000',
                            dashStyle: 'Dot'
                        }, {
                            name: "報酬",
                            data: item.revenue,
                            color: '#ABA1E4'
                        }, {
                            name: "累積每月投入",
                            data: item.invest,
                            color: '#86BDDD'
                        }, {
                            name: "預估法定退休金",
                            data: item.retire,
                            color: '#238C6C'
                        }, {
                            name: "已準備金",
                            data: item.prepared,
                            color: '#FFAD04'
                        }]
                    });
                });
            }
            //#endregion

            //#region 資產配置圓餅圖顯示
            function renderChartsAssets(chartsAssets) {
                chartsAssets.forEach(item => {
                    Highcharts.chart(item.id, {
                        chart: {
                            type: 'pie'
                        },
                        title: {
                            text: undefined
                        },
                        legend: {
                            labelFormat: '{alias}',
                            align: 'left',
                            alignColumns: false,
                            itemDistance: 12,
                            margin: 0,
                            padding: 0,
                            itemStyle: {
                                font: '1em Microsoft JhengHei, Arial, Helvetica, sans-serif',
                                cursor: 'default'
                            }
                        },
                        tooltip: {
                            pointFormat: '{point.name}：{point.y}',
                            headerFormat: undefined,
                            style: {
                                fontFamily: 'Microsoft JhengHei, Arial, Helvetica, sans-serif',
                                fontSize: '16px',
                                fontWeight: 'normal'
                            },
                            shadow: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        credits: {
                            enabled: false
                        },
                        plotOptions: {
                            pie: {
                                size: 160,
                                allowPointSelect: false,
                                showInLegend: true,
                                cursor: 'pointer',
                                dataLabels: {
                                    alignTo: 'connectors',
                                    format: '{point.name}：{point.percentage:.1f}%',
                                    style: {
                                        fontFamily: 'Microsoft JhengHei, Arial, Helvetica, sans-serif',
                                        fontSize: '16px',
                                        fontWeight: 'normal'
                                    }
                                },
                                point: {
                                    events: {
                                        legendItemClick: function (e) {
                                            e.preventDefault();
                                        }
                                    }
                                }
                            }
                        },
                        series: [{
                            name: '資產配置',
                            data: [{
                                name: assetsData.stock.text,
                                alias: assetsData.stock.fieldName,
                                y: item.stock,
                                color: '#3AAB68'
                            }, {
                                name: assetsData.bond.text,
                                alias: assetsData.bond.fieldName,
                                y: item.bond,
                                color: '#D0AD72'
                            }, {
                                name: assetsData.currency.text,
                                alias: assetsData.currency.fieldName,
                                y: item.currency,
                                color: '#FDAA5E'
                            }]
                        }]
                    });
                });
            }
            //#endregion

            //#region 判斷登入遮罩顯示
            function renderNotLogin() {
                const NotLoginHTML = `
                            <div class="c-calcLocker">
                                <div class="l-wrap">
                                    <div class="c-calcLocker__icon">
                                                    <img src="${lockImg}" alt="">
                                    </div>
                                        <div class="c-calcLocker__desc t2 t-bold">登入儲存試算結果及查看推薦商品</div>
                                        <div class="c-calcLocker__desc" style="color:#808080">*第三方登入僅有儲存功能</div>
                                    <div class="c-calcLocker__actions">
                                        <div class="c-calcLocker__btn"><a href="#popupLogin" class="o-btn o-btn--primary o-btn--lg" data-popup="true">立即登入</a></div>
                                    </div>
                                </div>
                                </div>
                        `;
                $('.Locker').append(NotLoginHTML);
                $('.Locker').addClass("c-section--locker");
                $('[data-popup="true"]').magnificPopup({
                    type: 'inline',
                    midClick: true
                });
            }
            //#endregion

            //#region 判斷有無風險屬性遮罩顯示
            function renderNotRisk() {
                const NotRiskHTML = `
                                            <div class="c-calcLocker">
                                        <div class="l-wrap">
                                            <div class="c-calcLocker__icon">
                                                            <img src="${lockImg}" alt="">
                                            </div>
                                            <div class="c-calcLocker__desc t2 t-bold">進行風險屬性評估後即可獲得專屬推薦</div>
                                            <div class="c-calcLocker__actions">
                                                                <div class="c-calcLocker__btn"><a id="GOKYC2" href="#popupRisk" class="o-btn o-btn--primary o-btn--lg" data-popup="true">風險屬性評估</a></div>
                                            </div>
                                        </div>
                                    </div>
                                `;
                $('.Locker').append(NotRiskHTML);
                $('.Locker').addClass("c-section--locker");
            }
            //#endregion

            //#region 更新風險屬性相關內容
            function UpdateRiskAttributesContent(risk) {
                let imgSrc, warningText;

                switch (risk) {
                    case "1":
                        defaultRiskAttributes = 2;
                        imgSrc = '/themes/images/charts/rr2.svg';
                        warningText = '注意：由於您的風險屬性為 保守型，部分風險等級高的推薦標的無法做申購，請您留意！';
                        break;
                    case "2":
                        defaultRiskAttributes = 5;
                        imgSrc = '/themes/images/charts/rr4.svg';
                        warningText = '注意：由於您的風險屬性為 穩健型，部分風險等級高的推薦標的無法做申購，請您留意！';
                        break;
                    case "3":
                        defaultRiskAttributes = 7;
                        imgSrc = '/themes/images/charts/rr5.svg';
                        warningText = '注意：由於您的風險屬性為 積極型，部分風險等級高的推薦標的無法做申購，請您留意！';
                        break;
                    default:
                        console.error('Unknown risk attribute:', risk);
                        return;
                }

                $('.l-riskCard__charts img').attr('src', imgSrc);
                $('.warningNotice').text(warningText);
            }
            //#endregion

            //#region 取得基金資料
            function getFundData(tab, event, eventString, years, monthlyInvestment, amountPrepared, targetAmount, pension, ExpectedRoi) {
                var resultTab3Roi = tab3Compute(years, monthlyInvestment, amountPrepared, targetAmount, pension);
                var expectedRoi;
                if (tab == 'tab1') {
                    expectedRoi = '';
                } else if (tab == 'tab3') {
                    expectedRoi = resultTab3Roi * 100;
                } else {
                    expectedRoi = ExpectedRoi;
                }

                var token = $('input[name="__RequestVerificationToken"]').val();

                $.ajax({
                    url: '@ClientRoute.GenerateUrl(this, "Calculate", "GetFundData")',
                    method: 'POST',
                    data: {
                        ExpectedRoi: expectedRoi,
                        ProductFundIDs: fundIds,
                        __RequestVerificationToken: token
                    },
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader("RequestVerificationToken", token);
                    },
                    success: function (data) {
                        if (data != null && data.length != 0) {
                            $(`#${tab}Fund`).removeClass('u-hidden');
                            RealrenderRecommendedFunds(tab, event, data);
                            FundinitializeSwiper(eventString);
                        } else {
                            $(`#${tab}Fund`).addClass('u-hidden');
                        }
                    },
                    error: function (xhr, status, error) {
                        console.log(error);
                    }
                });
            }
            //#endregion

            //#region 取得ETF資料
            function getEtfData(tab, eventEtf, eventStringEtf, years, monthlyInvestment, amountPrepared, targetAmount, pension, ExpectedRoi) {
                var riskLevel;
                var resultTab3Roi = tab3Compute(years, monthlyInvestment, amountPrepared, targetAmount, pension);
                var expectedRoi;

                if (tab === 'tab1') {
                    expectedRoi = '';
                } else if (tab === 'tab3') {
                    expectedRoi = resultTab3Roi * 100;
                } else {
                    expectedRoi = ExpectedRoi;
                }

                if (SC_DATA.Risk == '1') {
                    riskLevel = "'RR1','RR2'";
                } else if (SC_DATA.Risk == '2') {
                    riskLevel = "'RR1','RR2','RR3','RR4'";
                } else if (SC_DATA.Risk == '3') {
                    riskLevel = "'RR1','RR2','RR3','RR4','RR5'";
                }

                var token = $('input[name="__RequestVerificationToken"]').val();

                $.ajax({
                    url: '@ClientRoute.GenerateUrl(this, "Calculate", "GetEtfData")',
                    method: 'POST',
                    data: {
                        ExpectedRoi: expectedRoi,
                        RiskLevel: riskLevel,
                        __RequestVerificationToken: token
                    },
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader("RequestVerificationToken", token);
                    },
                    success: function (data) {
                        if (data != null && data.length != 0) {

                            $(`#${tab}ETF`).removeClass('u-hidden');
                            RealrenderRecommendedETFs(tab, eventEtf, data);
                            ETFinitializeSwiper(eventStringEtf);
                        } else {
                            $(`#${tab}ETF`).addClass('u-hidden');
                        }
                    },
                    error: function (xhr, status, error) {
                        console.log(error);
                    }
                });
            }
            //#endregion

            //#region  預設推薦基金商品顯示
            function renderRecommendedFunds(count) {
                for (let i = 1; i <= count; i++) {
                    const fundHTML = `
                                        <div class="swiper-slide c-swiper__slide">
                                            <div class="c-box c-box--goods">
                                                <div class="c-box__main">
                                                    <div class="c-cardFund">
                                                        <a href="#" class="c-cardFund__name u-ellipsis-2">
                                                            推薦基金 ${i}
                                                        </a>
                                                        <div class="c-cardFund__trend">
                                                            <div class="c-cardFund__rate">
                                                                <span class="t-small">
                                                                    <span class="t-fall">月報酬率</span>
                                                                    <span class="o-fall o-fall--sm">0%</span>
                                                                </span>
                                                            </div>
                                                            <div class="c-cardFund__charts">
                                                                <div class="o-charts o-charts--fall" data-chart="mini"></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="c-box__actions">
                                                    <ul class="l-collect l-collect--divider">
                                                        <li class="l-collect__item">
                                                            <a href="#" class="o-statusBtn o-statusBtn--like" data-after="關注" data-after-lt="關注" data-msg="加入關注|取消關注" data-ia="true"></a>
                                                        </li>
                                                        <li class="l-collect__item">
                                                            <a href="#" class="o-statusBtn o-statusBtn--compare" data-after="比較" data-after-lt="比較" data-msg="加入比較|取消比較" data-ia="true"></a>
                                                        </li>
                                                        <li class="l-collect__item l-collect__item--btn">
                                                            <a href="#popupPurchase" class="o-tableBtn o-tableBtn--card" data-popup="true">申購</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                    $('.recommendedFunds .swiper-wrapper').append(fundHTML);
                }
                let eventString = '.recommendedFunds';
                FundinitializeSwiper(eventString);
            }
            //#endregion

            //#region  真實推薦基金商品顯示
            function RealrenderRecommendedFunds(tab, event, fundData) {

                var dataIsFormSitecore = fundData.some(item => item.DataIsFormSitecore);

                $(`.${tab}FundTip`).text(dataIsFormSitecore ? '目前依績效評估，暫時無符合您需求之推薦標的，建議可參考下列本行推薦基金標的。' : '');

                const $swiperWrapper = event;
                $swiperWrapper.empty();
                let fundHTML = '';
                let style1, style2, style3;

                fundData.forEach((fund, index) => {
                    let SubscribeButtonHtml = '';

                    if (fund.OneMonthReturnOriginalCurrency > 0) {
                        style1 = "t-rise";
                        style2 = "o-rise o-rise--sm";
                        style3 = "o-charts--rise";
                    }
                    else {
                        style1 = "t-fall";
                        style2 = "o-fall o-fall--sm";
                        style3 = "o-charts--fall";
                    }

                    if (fund.SubscribeButtonHtml != null && fund.SubscribeButtonHtml != "") {
                        SubscribeButtonHtml = `<li class="l-collect__item l-collect__item--btn">${fund.SubscribeButtonHtml}</li>`;
                    }

                    fundHTML += `
                                    <div class="swiper-slide c-swiper__slide">
                                        <div class="c-box c-box--goods">
                                            <div class="c-box__main">
                                                <div class="c-cardFund">
                                                                    <a href="${fund.FundDetailUrl}" class="c-cardFund__name u-ellipsis-2"target="_blank">
                                                                ${fund.ProductCode} ${fund.FundName}
                                                    </a>
                                                    <div class="c-cardFund__trend">
                                                        <div class="c-cardFund__rate">
                                                            <span class="t-small">
                                                                <span class="${style1}">月報酬率</span>
                                                                       <span class="${style2}">${fund.DisplayOneMonthReturnOriginalCurrency}%</span>
                                                            </span>
                                                        </div>
                                                        <div class="c-cardFund__charts">
                                                            <div class="o-charts ${style3}" data-chart="${tab}miniFund"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="c-box__actions">
                                                <ul class="l-collect l-collect--divider">

                                                    <li class="l-collect__item">
                                                        ${fund.FocusButtonHtml}
                                                    </li>
                                                    <li class="l-collect__item">
                                                        ${fund.CompareButtonHtml}
                                                    </li>
                                                    ${SubscribeButtonHtml}
                                                </ul>
                                            </div>
                                        </div>
                                    </div> `;
                });
                $swiperWrapper.append(fundHTML);

                // 綁定 關注/比較 icon 的互動功能
                $swiperWrapper.find('[data-ia]').interactive();
                // 綁定 like icon 的彈跳登入畫面
                $swiperWrapper.find('[data-popup]').magnificPopup();
                $swiperWrapper.find('[eh-compare]').trigger('exec');
                $swiperWrapper.find('[eh-focus]').trigger('exec');
                $swiperWrapper.find('[eh-subscription-type]').trigger('exec');

                RealrenderFundChart(tab, fundData);
            }
            //#endregion

            //#region  預設推薦ETF商品顯示
            function renderRecommendedETFs(count) {
                for (let i = 1; i <= count; i++) {
                    const etfHTML = `
                                        <div class="swiper-slide c-swiper__slide">
                                            <div class="c-box c-box--goods">
                                                <div class="c-box__main">
                                                    <div class="c-cardFund">
                                                        <a href="#" class="c-cardFund__name u-ellipsis-2">
                                                                推薦ETF ${i}
                                                        </a>
                                                        <div class="c-cardFund__trend">
                                                            <div class="c-cardFund__rate">
                                                                <span class="t-small">
                                                                    <span class="t-rise">月報酬率</span>
                                                                    <span class="o-rise o-rise--sm">0%</span>
                                                                </span>
                                                            </div>
                                                            <div class="c-cardFund__charts">
                                                                <div class="o-charts o-charts--rise" data-chart="mini"></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="c-box__actions">
                                                    <ul class="l-collect l-collect--divider">
                                                        <li class="l-collect__item">
                                                            <a href="#" class="o-statusBtn o-statusBtn--like" data-after="關注" data-after-lt="關注" data-msg="加入關注|取消關注" data-ia="true"></a>
                                                        </li>
                                                        <li class="l-collect__item">
                                                            <a href="#" class="o-statusBtn o-statusBtn--compare" data-after="比較" data-after-lt="比較" data-msg="加入比較|取消比較" data-ia="true"></a>
                                                        </li>
                                                        <li class="l-collect__item l-collect__item--btn">
                                                            <a href="#popupPurchase" class="o-tableBtn o-tableBtn--card" data-popup="true">申購</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                    $('.recommendedETF .swiper-wrapper').append(etfHTML);
                }
                let eventStringEtf = '.recommendedETF';
                ETFinitializeSwiper(eventStringEtf);
            }
            //#endregion

            //#region  真實推薦ETF商品顯示
            function RealrenderRecommendedETFs(tab, eventEtf, EtfData) {
                const $swiperWrapper = eventEtf;
                $swiperWrapper.empty();
                let EtfHTML = '';
                let style1, style2, style3;

                EtfData.forEach((Etf, index) => {
                    let SubscribeButtonHtml = '';

                    if (Etf.MonthlyReturnNetValueOriginalCurrency > 0) {
                        style1 = "t-rise";
                        style2 = "o-rise o-rise--sm";
                        style3 = "o-charts--rise";
                    }
                    else {
                        style1 = "t-fall";
                        style2 = "o-fall o-fall--sm";
                        style3 = "o-charts--fall";
                    }

                    if (Etf.SubscribeButtonHtml != null && Etf.SubscribeButtonHtml != "") {
                        SubscribeButtonHtml = `<li class="l-collect__item l-collect__item--btn">${Etf.SubscribeButtonHtml}</li>`;
                    }

                    EtfHTML += `
                                        <div class="swiper-slide c-swiper__slide">
                                            <div class="c-box c-box--goods">
                                                <div class="c-box__main">
                                                    <div class="c-cardFund">
                                                                                <a href="${Etf.ETFDetailUrl}" class="c-cardFund__name u-ellipsis-2"target="_blank">
                                                                        ${Etf.ProductCode} ${Etf.ETFName}
                                                        </a>
                                                        <div class="c-cardFund__trend">
                                                            <div class="c-cardFund__rate">
                                                                <span class="t-small">
                                                                    <span class="${style1}">月報酬率</span>
                                                                                   <span class="${style2}">${Etf.DisplayMonthlyReturnNetValueOriginalCurrency}%</span>
                                                                </span>
                                                            </div>
                                                            <div class="c-cardFund__charts">
                                                                <div class="o-charts ${style3}" data-chart="${tab}miniETF"></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="c-box__actions">
                                                    <ul class="l-collect l-collect--divider">
                                                        <li class="l-collect__item">
                                                            ${Etf.FocusButtonHtml}
                                                        </li>
                                                        <li class="l-collect__item">
                                                            ${Etf.CompareButtonHtml}
                                                        </li>
                                                        ${SubscribeButtonHtml}
                                                    </ul>
                                                </div>
                                            </div>
                                        </div> `;
                });
                $swiperWrapper.append(EtfHTML);

                // 綁定 關注/比較 icon 的互動功能
                $swiperWrapper.find('[data-ia]').interactive();
                // 綁定 like icon 的彈跳登入畫面
                $swiperWrapper.find('[data-popup]').magnificPopup();
                $swiperWrapper.find('[eh-compare]').trigger('exec');
                $swiperWrapper.find('[eh-focus]').trigger('exec');
                $swiperWrapper.find('[eh-subscription-type]').trigger('exec');

                RealrenderEtfChart(tab, EtfData);
            }
            //#endregion

            //#region  推薦國外股票商品顯示
            function renderRecommendedStocks(count) {
                for (let i = 1; i <= count; i++) {
                    const stockHTML = `
                                        <div class="swiper-slide c-swiper__slide">
                                            <div class="c-box c-box--goods">
                                                <div class="c-box__main">
                                                    <div class="c-cardFund">
                                                        <a href="#" class="c-cardFund__name u-ellipsis-2">
                                                            推薦國外股票 ${i}
                                                        </a>
                                                        <div class="c-cardFund__trend">
                                                            <div class="c-cardFund__rate">
                                                                <span class="t-small">
                                                                    <span class="t-rise">月報酬率</span>
                                                                    <span class="o-rise o-rise--sm">0%</span>
                                                                </span>
                                                            </div>
                                                            <div class="c-cardFund__charts">
                                                                <div class="o-charts o-charts--rise" data-chart="mini"></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="c-box__actions">
                                                    <ul class="l-collect l-collect--divider">
                                                        <li class="l-collect__item">
                                                            <a href="#" class="o-statusBtn o-statusBtn--like" data-after="關注" data-after-lt="關注" data-msg="加入關注|取消關注" data-ia="true"></a>
                                                        </li>
                                                        <li class="l-collect__item l-collect__item--btn">
                                                            <a href="#popupPurchase" class="o-tableBtn o-tableBtn--card" data-popup="true">申購</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                    $('.recommendedStock .swiper-wrapper').append(stockHTML);
                }
                StockinitializeSwiper();
            }
            //#endregion

            //#region 所有推薦基金初始化設定
            function FundinitializeSwiper(eventString) {
                window.mySwiper = new Swiper(eventString, {
                    slidesPerGroup: 1,
                    slidesPerView: 1,
                    grid: {
                        rows: 1
                    },
                    spaceBetween: 20,
                    lazy: true,
                    loop: true,
                    breakpoints: {
                        1200: {
                            slidesPerGroup: 3,
                            slidesPerView: 3,
                            grid: {
                                rows: 3
                            }
                        }
                    },
                    autoplay: {
                        delay: 6000,
                        disableOnInteraction: false
                    },
                    speed: 1000,
                    pagination: {
                        el: '.swiper-pagination',
                        clickable: true
                    },
                    navigation: {
                        nextEl: '.swiper-button-next',
                        prevEl: '.swiper-button-prev',
                        disabledClass: 'swiper-button-disabled'
                    }
                });
            }
            //#endregion

            //#region 所有推薦ETF初始化設定
            function ETFinitializeSwiper(eventStringEtf) {
                window.mySwiper = new Swiper(eventStringEtf, {
                    slidesPerView: 1,
                    spaceBetween: 20,
                    lazy: true,
                    loop: true,
                    breakpoints: {
                        1200: {
                            slidesPerView: 3
                        }
                    },
                    autoplay: {
                        delay: 6000,
                        disableOnInteraction: false
                    },
                    speed: 1000,
                    pagination: {
                        el: '.swiper-pagination',
                        clickable: true
                    },
                    navigation: {
                        nextEl: '.swiper-button-next',
                        prevEl: '.swiper-button-prev',
                        disabledClass: 'swiper-button-disabled'
                    }
                });
            }
            //#endregion

            //#region 所有推薦國外股票初始化設定
            function StockinitializeSwiper() {
                window.mySwiper = new Swiper('.recommendedStock', {
                    slidesPerView: 1,
                    spaceBetween: 20,
                    lazy: true,
                    loop: true,
                    breakpoints: {
                        1200: {
                            slidesPerView: 3
                        }
                    },
                    autoplay: {
                        delay: 6000,
                        disableOnInteraction: false
                    },
                    speed: 1000,
                    pagination: {
                        el: '.swiper-pagination',
                        clickable: true
                    },
                    navigation: {
                        nextEl: '.swiper-button-next',
                        prevEl: '.swiper-button-prev',
                        disabledClass: 'swiper-button-disabled'
                    }
                });
            }
            //#endregion

            //#region 預設推薦基金、推薦ETF、推薦國外股票走勢圖顯示
            function renderRecommendedProductChart() {
                $('[data-chart="mini"]').each(function (i, el) {
                    $(el).highcharts({
                        chart: {
                            type: 'area',
                            margin: [0, 0, 0, 0],
                            backgroundColor: 'transparent'
                        },
                        title: {
                            text: undefined
                        },
                        legend: {
                            enabled: false
                        },
                        plotOptions: {
                            series: {
                                enableMouseTracking: false,
                                marker: {
                                    enabled: false
                                }
                            }
                        },
                        credits: {
                            enabled: false
                        },
                        xAxis: {
                            visible: false
                        },
                        yAxis: {
                            visible: false
                        },
                        series: [{
                            fillOpacity: 0.06,
                            data: [13.833, 12.524, 11.441, 10.651, 9.961, 4.566, 4.617, 4.728, 4.823, 4.844, 4.856, 4.87, 4.702, 4.679, 4.674, 4.641, 4.47, 4.688, 4.798, 2.015, 1.971, 1.894, 1.848, 1.835, 1.85, 2.036, 1.827, 1.904, 1.803, 1.852, 1.866, 1.906, 1.956, 1.954, 1.734, 1.904, 2.702, 2.893, 3.016, 3.073, 3.126, 3.283, 3.361, 3.33, 3.465, 3.916, 4.49, 5.074, 5.717, 6.523, 7.012, 6.726, 7.095, 7.471, 7.824, 7.802, 4.441, 4.625, 4.934, 4.952, 4.742, 4.666, 4.525, 4.126, 4.228, 4.334, 4.383, 5.287, 5.088, 5.28, 5.274, 5.251, 5.413, 5.365, 5.372, 5.512, 4.839, 5.099, 5.196, 5.219, 5.094, 5.582, 5.91, 5.952, 6.012, 5.854, 5.789, 5.465, 5.525, 5.659, 5.67, 5.173, 5.033, 5.318, 5.289, 5.226, 5.15, 5.106, 4.989, 5.103, 5.288, 5.428, 5.363, 5.026, 5, 4.941, 4.872, 4.751, 4.408, 4.425, 4.301, 4.134, 4.171, 4.272, 4.34, 4.543, 4.826, 5.381, 5.374, 5.433, 5.483, 5.539, 5.869, 6.956, 7.443, 7.654, 8.005, 8.181, 8.386, 9.202, 9.51, 9.66, 9.141, 8.79, 8.747, 8.949, 9.188, 9.625, 10.154, 10.173, 10.361, 11.186, 11.226, 11.091, 10.899, 10.945, 10.892, 9.618, 9.092, 8.465, 7.864, 7.396, 7.076, 7.053, 6.772, 6.958, 7.202]
                        }]
                    });
                });
            }
            //#endregion

            //#region 真實推薦基金走勢圖顯示
            function RealrenderFundChart(tab, data) {
                $(`[data-chart="${tab}miniFund"]`).each(function (i, el) {
                    // 使用 data 数组中的相应数据来渲染每个图表
                    $(el).highcharts({
                        chart: {
                            type: 'area',
                            margin: [0, 0, 0, 0],
                            backgroundColor: 'transparent'
                        },
                        title: {
                            text: undefined
                        },
                        legend: {
                            enabled: false
                        },
                        plotOptions: {
                            series: {
                                enableMouseTracking: false,
                                marker: {
                                    enabled: false
                                }
                            }
                        },
                        credits: {
                            enabled: false
                        },
                        xAxis: {
                            visible: false
                        },
                        yAxis: {
                            visible: false
                        },
                        series: [{
                            fillOpacity: 0.06,
                            data: data[i].SysjustNavFundData
                        }]
                    });
                });
            }
            //#endregion

            //#region 真實推薦ETF走勢圖顯示
            function RealrenderEtfChart(tab, data) {
                $(`[data-chart="${tab}miniETF"]`).each(function (i, el) {
                    // 使用 data 数组中的相应数据来渲染每个图表
                    $(el).highcharts({
                        chart: {
                            type: 'area',
                            margin: [0, 0, 0, 0],
                            backgroundColor: 'transparent'
                        },
                        title: {
                            text: undefined
                        },
                        legend: {
                            enabled: false
                        },
                        plotOptions: {
                            series: {
                                enableMouseTracking: false,
                                marker: {
                                    enabled: false
                                }
                            }
                        },
                        credits: {
                            enabled: false
                        },
                        xAxis: {
                            visible: false
                        },
                        yAxis: {
                            visible: false
                        },
                        series: [{
                            fillOpacity: 0.06,
                            data: data[i].SysjustNavEtfData
                        }]
                    });
                });
            }
            //#endregion

            //#region loading方法
            function loading() {
                window.loading('show');
                setTimeout(() => {
                    window.loading('hide');
                }, 1000);
            }
            //#endregion
        });
    })(jQuery, window, document);
</script>